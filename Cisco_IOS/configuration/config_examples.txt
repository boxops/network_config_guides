### Cisco_IOS with CCNA Topics ###

### Configure Hostname

conf t
hostname R1
do sh run | inc host


### Configure Interface with IP address

interface FastEthernet0/0
ip address 10.1.1.1 255.255.255.0
no shutdown


### Set Up an IOS Router or Switch as SSH Client

# There are four steps required to enable SSH support on a Cisco IOS:

# 1. Configure the hostname command.
# 2. Configure the DNS domain.
# 3. Generate the SSH key to be used.
# 4. Enable SSH transport support for the virtual type terminal (vtys).

configure terminal
hostname R1
ip domain name cisco.com
username admin privilege 15 password Cisco123
line con 0
password cisco
login
exit
line vty 0 4
password cisco
login local
logging synchronous
transport input all
exit
line vty 5 15
password cisco
login local
logging synchronous
transport input all
exit
crypto key generate rsa
1024
ip ssh version 2
banner motd # Unauthorised access is strictly prohibited! #
end
wr


### Standard ACL

# access-list number { deny | permit } ip wildcard-mask
access-list 1 deny 1.1.1.1 0.0.0.0
access-list 1 deny 1.1.1.1
access-list 1 deny host 1.1.1.1
access-list 1 permit any
access-list 1 permit 0.0.0.0 255.255.255.255
access-list 1 remark ## BLOCK PERSON FROM ACCOUNTING ##

show access-lists
show ip access-lists

# Permit a single host from a subnet
access-list 1 permit 192.168.1.1
access-list 1 deny 192.168.1.0 0.0.0.255
interface g0/1
ip access-group 1 out

# Named ACL
ip access-list standard { acl-name }
[ entry number ] { deny | permit } ip wildcard-mask


### Better ACL Config

# Standard ACL
# Numbered ACL Ranges: 100-199, 2000-2699

ip access-list standard 1
# or
ip access-list standard BLOCK_PC1
deny 192.168.1.1
permit any
do show access list
# delete an entry
no 30

# insert a new entry by specifying the sequence number
30 deny 192.168.2.0 0.0.0.255

# resequence ACLs
# ip access-list resequence [acl-id] [starting-seq-num] [increment]
# [starting-seq-num] = change the sequence number of the first entry to 10
# [increment] = add 10 for every entry after that
ip access-list resequence 1 10 10

# NOTE - When configuring or editing numbered ACLs from global config mode,
# you cannot delete individual entries, you can only delete the entire ACL!


### Extended ACLs

# Extendend Numbered ACL
# access-list [number] (permit | deny) [protocol] [src-ip] [dest-ip]

# Extended Named ACL
# ip access-list extended (name | number)
# [seq-num] (permit | deny) [protocol] [src-ip] [dest-ip]
ip acccess-list extended DENY_VLAN10
deny tcp any 10.0.0.0 0.0.0.255

# examples
# allow all traffic
permit ip any any
# prevent 10.0.0.0/16 from sending UDP traffic to 192.168.1.1/32
deny udp 10.0.0.0 0.0.255.255 host 192.168.1.1
# prevent 172.16.1.1/32 from pinging hosts in 192.168.0.0/24
deny icmp host 172.16.1.1 192.168.0.0 0.0.0.255
# When matching TCP or UDP, you can optionally specify the source and/or destination port numbers to match
deny tcp [src-ip] eq [src-port-num] [dest-ip]
deny tcp 10.1.1.1 eq 80 10.2.2.2
# eq 80 = equal to port 80
# gt 80 = greater than 80 (<81)
# lt 80 = less than 80 (>79)
# neq 80 = NOT 80
# range 80 100 = port from 80 to port 100

# After the destination IP address and/or port numbers, there are more options you can use to match
# ack = match TCP ACK flag
# fin = match TCP FIN flag
# syn = match TCP SYN flag
# ttl = match packets with a specific TTL value
# dscp = match packets with a specific DSCP value

# examples
# allow traffic from 10.0.0.0/16 to access the server at 2.2.2.2/32 using HTTPS
permit tcp 10.0.0.0 0.0.255.255 2.2.2.2 0.0.0.0 eq 443
# prevent all hosts using source UDP port numbers from 20000 to 30000 from accessing the server at 3.3.3.3/32
deny udp any range 20000 30000 host 3.3.3.3
# allow hosts in 172.16.1.0/24 using a TCP source port greater than 9999 to access all TCP ports on server 4.4.4.4/32 except port 23
permit tcp 172.16.1.0 0.0.0.255 gt 9999 host 4.4.4.4 neq 23

# Applying Extended ACLs to interfaces
# Note - Extended ACLs should be applied as close to the soruce as possible to limit how far the packets travel in the network before being denied. Standard ACLs are less specific, so if they are applied close to the source there is a risk of blocking more than intended.

interface g0/1
ip access-group HTTP_SRV1 in

# Prevent R1 from forwarding OSPF packets out of G0/2
ip access-list extended 112
deny 89 any any
permit ip any any
interface g0/2
ip access-group 112 out


### Static Routing

# ip route [ remote network ] [ remote network subnet ] [ neighbour interface ]
ip route 10.1.1.0 255.255.255.0 10.1.2.1

### OSPF Dynamic Routing

OSPF Neighbour Requirements

1. Area must match
2. Area must be in the same subnet
3. OSPF process must not be sutdown
4. OSPF Router IDs must be unique
5. Hello and Dead timers must match
6. Autohentication settings must match
7. IP MTU settings must match
8. OSPF Network Type must match


OSPF Types of LSA

Type 1 (Router LSA)
- Every OSPF rotuer generates this type of LSA.
- It identifies the router using its router ID.
- It also lists networks attached to the rotuer's OSPF-activated interfaces.

Type 2 (Network LSA)
- Generated by the DR of each 'multi-access' network (ie. the broadcast network type).
- Lists the routers which are attached to the multi-access network.

Type 5 (AS External LSA)
- Generated by ASBRs to describe routes to destinations outside of the AS (OSPF domain).


### Subinterfaces for Router on a Stick

# On R1
int g0/0.10
encapsulation dot1Q 10
ip address 10.0.0.62 255.255.255.192

int g0/0.20
encapsulation dot1Q 20
ip address 10.0.0.216 255.255.255.192

# On SW1
int g0/0
switchport mode trunk
exit
vlan 10
name VLAN-A
vlan 20
name VLAN-B
int f0/1
switchport mode access
switchport access vlan 10
exit
int f0/2
switchport mode access
switchport access vlan 20
exit

show vlans


### Etherchannel

# LACP SW1
int range g0/1-2
channel-group 1 mode active
exit
int po1
switchport trunk encapsulation dot1q
switchport mode trunk

# LACP SW2
int range g0/3-4
channel-group 1 mode active
exit
int po1
switchport trunk encapsulation dot1q
switchport mode trunk

# Static Etherchannel
# DSW1
int range g0/1-2
no switchport
channel-group 2 mode on
int po2
ip add 10.0.0.1 255.255.255.252

# DSW2
int range g0/1-2
no switchport
channel-group 2 mode on
int po2
ip add 10.0.0.2 255.255.255.252

show etherchannel summary

# Etherchannel load-balance
port-channel load-balance src-dst-ip

show etherchannel load-balance


### HSRP

# R1
int g0/0
standby version 2
standby 1 ip 10.0.1.254
standby 1 pirority 200
standby 1 preempt

# R2
int g0/0
standby version 2
standby 1 ip 10.0.1.254
standby 1 pirority 50

show standby


### CDP

# Enable / disable CDP globally
[no] cdp run

# Enable / disable CDP on specirfic interfaces
interface g0/1
[no] cdp enable

# Configure the CDP timer
cdp timer (seconds)

# Configure the CDP holdtime
cdp holdtime (seconds)

# Enable / disable CDPv2
[no] cdp advertise-v2

# CDP show commands
show cdp
show cdp traffic
show cdp interface
show cdp  neighbours
show cdp detail
show cdp entry (name)


### LLDP

# Enable / disable LLDP
[no] lldp run

# Enable / disable LLDP on specirfic interfaces (tx)
int g0/1
[no] lldp transmit

# Enable / disable LLDP on specirfic interfaces (rx)
int g0/1
[no] lldp receive

# Configure the LLDP timer
lldp timer (seconds)

# Configure the LLDP holdtime
lldp holdtime (seconds)

# Configure the LLDP reinit timer
lldp reinit (seconds)

# LLDP show commands
show lldp
show lldp traffic
show lldp interface
show lldp  neighbours
show lldp detail
show lldp entry (name)


### NTP

# The most important reason to have accurate time on a device
# is to have accurate logs for troubleshooting.

show clock
show clock detail
show calendar

# Manual clock configuration (Internal clocks will drift, so it is not ideal)
clock set 14:30:00 27 July 2022
clock timezone GMT 0
ntp update-calendar

# Configure NTP servers
ntp server 216.239.35.0
ntp server 216.239.35.4
ntp server 216.239.35.8
ntp server 216.239.35.12

show ntp status
show ntp associations

# NTP authentication

# R1
ntp authenticate
ntp authentication-key 1 md5 myCiscoLab
ntp trusted-key 1

# R2
ntp authenticate
ntp authentication-key 1 md5 myCiscoLab
ntp trusted-key 1
ntp server 10.0.12.1 key 1
ntp peer 10.0.23.2 key 1

# R3
ntp authenticate
ntp authentication-key 1 md5 myCiscoLab
ntp trusted-key 1
ntp server 10.0.12.1 key 1
ntp peer 10.0.23.1 key 1


### DHCP

# Configure a router to act as a DHCP Server

ip dhcp excluded-address 192.168.1.1 192.168.1.10
ip dhcp pool LAB_POOL
network 192.168.1.0 255.255.255.0
dns-server 8.8.8.8
domain-name cisco.com
default-router 192.168.1.1
# lease [days] [hours] [minutes]
lease 0 5 30
# lease infinite

show ip dhcp binding
show ip dhcp server statistics

# Configure a router to act as a DHCP Relay Agent

interface g0/1
ip helper-address 192.168.10.10

show ip interface g0/1

# Configure a router to be a DHCP Client

interface g0/1
ip address dhcp

sh ip interface g0/1


### SNMP

http://oid-info.com/

# SNMP Agent port = UDP 161
# SNMP Manager port = UDP 162

## SNMP Read Messages
# Messages sent by the NMS to read information from the managed devices.

# Get - A request sent from the manager to the agent to retrieve the value of a variable (OID), or multiple variables.
# The agent will send a Response message with the current value of each variable.

# GetNext - A request sent from the manager to the agent to discover the available variables on the MIB.

# GetBulk - A more efficient version of the GetNext message (introduced in SNMPv2).

## SNMP Write Messages
# Messages sent by the NMS to change information on the managed devices.

# Set - A request sent from the manager to the agent to change the value of one or more variables.
# The agent will send a Response message with the new values.

## SNMP Notification
# Messages sent by the managed devices to alert the NMS of a particular event.

# Trap - A notification sent from the agent to the manager. 
# The manager does not send a Response message to acknowledge that it received the Trap, so these messages are unreliable.

# Inform - A notification message that is acknowledged with a Response message.
# Originally used for communications between managers, but later updates allow agents to send Inform messages to managers too.

## SNMP Response
# Messages sent in response to a previous message/request.


## SNMPv2c Configuration

snmp-server contact example@google.com
snmp-server location "Rack B1"
snmp-server community CCNA1 ro
snmp-server community CCNA2 rw
# Specify the address of the NMS (version and which community string to use)
snmp-server host 192.168.1.1 version 2c CCNA1
# Traps will be sent if an interface goes up or down
snmp-server enable traps snmp linkdown linkup
# Traps will be sent if configuration changes are made
snmp-server enable traps config

show snmp community
show snmp contact
show snmp host
show snmp location


## SNMPv3 Configuration

Username: UserJustMe
Authentication Password: AuthPass1
Privacy Password: PrivPass2
View Name: ViewDefault
Group Name: GrpMonitoring

# IOS & IOS-XE
snmp-server view ViewDefault iso included
snmp-server group GrpMonitoring v3 priv read ViewDefault
snmp-server user UserJustMe GrpMonitoring v3 auth sha AuthPass1 priv aes 128 PrivPass2

# IOS-XR
snmp-server view ViewDefault iso included 
snmp-server group GrpMonitoring v3 priv read ViewDefault
snmp-server user UserJustMe GrpMonitoring v3 auth sha AuthPass1 priv aes 128 PrivPass2

# Nexus Switch (OS-NX)
snmp-server user UserJustMe network-admin v3 auth sha AuthPass1 priv aes-128 PrivPass2

# ASA firewall
snmp-server group GrpMonitoring v3 priv
snmp-server user UserJustMe GrpMonitoring v3 auth sha AuthPass1 priv aes 128 PrivPass2
snmp-server host mgmt 10.1.1.161 version 3 UserJustMe

# Testing SNMPv3 configuration with Net-SNMP
# apt-get install snmp
snmpwalk -v3 -l authPriv -u UserJustMe -a SHA -A AuthPass1 -x AES -X PrivPass2 10.7.1.9:161 sysDescr


### Syslog

# Syslog server port (listen) = UDP 514

# seq:time stamp: %facility-severity-MNEMONIC:description
# [sequence number]:[timestamp]: %[which process]-[severity number]-[short message]:[detailed information]

# Examples
# *Feb 11 03:02:55.304: %LINK-3-UPDOWN: Interface GigabitEthernet0/0, changed state to up
# *Feb 11 03:02:55.304: %OSPF-5-ADJCHG: Process 1, Nbr 192.168.1.2 on GigabitEthernet0/0 from LOADING to FULL, Loading Done
# *Feb 11 03:02:55.304: %SYS-5-CONFIG_I: Configured from console by admin on console
# *Feb 11 03:02:55.304: %SYS-6-CLOCKUPDATE: System clock has been updated from 07:27:23 UTC Thu Feb 11 2021 to 16:27:23 JST Thu Feb 11 2021, configured from console by admin on console.

# Syslog severity levels
# Level - Keyword - Description
# 0 - Emergency - System is unusable
# 1 - Alert - Action must be taken immediately
# 2 - Critical - Critical conditions
# 3 - Error - Error conditions
# 4 - Warning - Warning conditions
# 5 - Notice - Normal but significant conditions
# 6 - Informational - Informational messages
# 7 - Debugging - Debug-level messages

# Memorize the severity levels
# Every Awesome Cisco Engineer Will Need Icecream Daily

## Syslog Logging Locations

# Console line: Syslog messages will be displayed in the CLI when connected to the device via the console port. All messages are displayed by default.

# VTY lines: Syslog messages will be displayed in the CLI when connected to the device via Telnet or SSH. Disabled by default.

# Buffer: Syslog messages will be saved to RAM. All messages will be displayed by default.

# External server: You can configure the device to send Syslog messages to an external server.


## Syslog Configuration

# Enable console logging for the Informational severity and higher
logging console 6
# Enable logging for the Informational severity and higher
logging monitor informational
# Logging buffered [size] [level name or number]
logging buffered 8192 6
# Logging to an external server
logging 192.168.1.100
# Or: logging host 192.168.1.100
# Logging trap [level name or number]
logging trap debugging

# Enable Syslog messages when using Telnet or SSH
terminal monitor

# Print a new line when the typing is interrupted by a Syslog message (more user friendly)
line console 0
logging synchronous

# Enable timestamps for Syslog messages
service timestamp log datetime
service sequence-numbers


### Console, Telnet, and SSH (local and remote connections)

## Configure a password on the console
line console 0
password ccna
# Require the user to enter the console password
login

## Configure a username and password on the console
username admin secret ccna
line console 0
# Require a user to login using the configured usernames on the device
login local
# Log the user out after a certain time of inactivity: exec-timeout [minutes] [seconds]
exec-timeout 3 30

## Configure the Switch Virtual Interface (SVI) on a Layer 2 switch for remote connectivity
interface vlan1
ip address 192.168.1.253 255.255.255.0
no shutdown
exit
ip default-gateway 192.168.1.254

## Teletype Network (Telnet) Configuration
# If an enable password or secret is not configured, you won't be able to access priviledged exec mode when connecting via Telnet
enable secret ccna
username admin secret ccna
# Optional. Limit which devices can connect
access-list 1 permit host 192.168.2.1
# There are 16 Virtual Teletype (vty) lines available for up to 16 users
line vty 0 15
login local
# Time out after 5 mins
exec-timeout 5 0
# Allow telnet connections
transport input telnet
# Apply the ACL to the vty lines
access-class 1 in

# Connect via Telnet
telnet [ip-address]

## SSH Configuration
# Hostname and DNS domain name must be defined first
hostname R1
ip domain name cisco.com
# Generate RSA keys
crypto key generate rsa modulus 2048

enable secret ccna
username admin secret ccna
# Optional. Limit which devices can connect
access-list 1 permit host 192.168.2.1
ip ssh version 2
line vty 0 15
login local
# Time out after 5 mins
exec-timeout 5 0
# Allow SSH connections
transport input ssh
# Apply the ACL to the vty lines
access-class 1 in

# Connect via SSH
ssh -l [username] [ip-address]
ssh [username]@[ip-address]


### FTP and TFTP (File Transfer Protocol and Trivial File Transfer Protocol)

TFTP server port listen = UDP 69
FTP control port = TCP 21
FTP data port = TCP 20

# FTPS (FTP over SSL/TLS) is an upgrade to FTP.
# SFTP (SSH File Transfer Protocol) is a different protocol to FTP.

# FTP is more compex than TFTP and allows not only file transfers, but clients can also navigate file directories, add and remove directories, list files, etc.

# In FTP active mode, the server initiates the data connection.
# In FTP passive mode, the client initiates the data connection, which is often necessary when the client is behind a firewall that could block the incoming connection from the server.

## IOS File Systems
show file systems

## Upgrading Cisco IOS
# View the current IOS version
show version
# View the contents of flash
show flash
# Copy the file using TFTP
# copy [source] [destination]
copy tftp: flash:
192.168.1.1
c2900-universalk9-mz.SPA.155-3.M4a.bin

# View the copied file
show flash

# Load and replace the file with the old one
conf t
boot system flash:c2900-universalk9-mz.SPA.155-3.M4a.bin
exit
write memory
reload

# Delete a file in flash
delete flash:c2900-universalk9-mz.SPA.151-4.M4.bin

## FTP copying files to a server
# An FTP username and password must be configured
ip ftp username cisco
ip ftp password cisco
exit
copy ftp: flash:
192.168.1.1
c2900-universalk9-mz.SPA.155-3.M4a.bin

## Password Recovery for the 2900 Integrated Services Router
https://www.cisco.com/c/en/us/support/docs/routers/2800-series-integrated-services-routers/112033-c2900-password-recovery-00.html

# Step-by-Step Procedure
# Perform these steps in order to recover your password:

# 1. Either switch off or shut down the router.
# 2. Remove the compact flash that is on the rear of the router. This image shows the rear of the 2951 router:
# 3. Switch on the router.
# 4. Once the router is on Rommon mode, reinsert the compact flash.
# 5. Type confreg 0x2142 at the rommon 1> prompt in order to boot from Flash.
# This step bypasses the startup configuration where the passwords are stored.
# 6. Type reset at the rommon 2> prompt.
# The router reboots, but ignores the saved configuration.
# 7. Type no after each setup question, or press Ctrl-C in order to skip the initial setup procedure.
# 8. Type enable at the Router> prompt.
# You are in enable mode and should see the Router# prompt.
# 9. Type configure memory or copy startup-config running-config in order to copy the nonvolatile RAM (NVRAM) into memory.
# Warning:  Do not enter copy running-config startup-config or write. These commands erase your startup configuration.
# 10. Issue the show running-config command.
# The show running-config command shows the configuration of the router. In this configuration, the shutdown command appears under all interfaces, which indicates all interfaces are currently shut down. In addition, the passwords (enable password, enable secret, vty, and console passwords) are in either an encrypted or unencrypted format. You can reuse unencrypted passwords. You must change encrypted passwords to a new password.
# 11. Type configure terminal.
# The hostname(config)# prompt appears.
# 12. Type enable secret <password> in order to change the enable secret password. For example:
# hostname(config)#enable secret cisco
# 13. Issue the no shutdown command on every interface that you use.
# If you issue a show ip interface brief command, every interface that you want to use should display up up.
# 14. Type config-register <configuration_register_setting> . Where <configuration_register_setting> is either the value you recorded in step 2 or 0x2102 . For example:
# hostname(config)#config-register 0x2102
# 15. Press Ctrl-z or end in order to leave the configuration mode.
# The hostname# prompt appears.
# 16. Type write memory or copy running-config startup-config in order to commit the changes.


### NAT

# RFC 1918 private IPv4 ranges (cannot be used over the Internet):
# Class A - 10.0.0.0/8 (10.0.0.0 to 10.255.255.255)
# Class B - 172.16.0.0/12 (172.16.0.0 to 172.31.255.255)
# Class C - 192.168.0.0/16 (192.168.0.0 to 192.168.255.255)

## Static NAT

# Involves statically configuring one-to-one mappings of private IP addresses to public IP addresses.
# Inside Local IP address is mapped to an inside global IP address. The IP configured on the host. Usually a private IP address.
# Inside Global IP address is the IP address of the inside host after NAT. Usually a public IP address.
# Outside Local is the IP address of the outside host from the perspective of the local network.
# Outside Global is the IP address of the outside host from the perspective of the outside network.

# Inside / OUtside = Location of the host
# Local / Global = Perspective

# One-to-one mapping allows external hosts to access the internal host via the inside global address.


## Static NAT Configuration

# Define inside interfaces connected to the internal network
int g0/1
ip nat inside
exit
# Define outside interfaces connected to the external network
int g0/0
ip nat outside
exit
# Configure the one-to-one IP address mappings
# ip nat inside source static [inside-local-ip] [inside-global-ip]
ip nat inside source static 192.168.0.167 100.0.0.1
# The following command will be rejected as a static entry already exists
ip nat inside source static 192.168.0.168 100.0.0.1

show ip nat translations
# Clear the dynamic IP translations only (static IP translations will remain)
clear ip nat translation *
show ip nat statistics


## Dynamic NAT

# The router dynamically maps inside local addresses to inside global addresses as needed.

# An ACL is used to identify which traffic should be translated.
# If the source IP is permitted by the ACL, then it will be translated.
# If the source IP is denied by the ACL, then it will NOT be translated (traffic will not be dropped).

# A NAT pool is used to determine the available inside global addresses.

# The mappings are still one-to-one (one inside local IP address per inside global IP address).

# If there aren't enough inside global IP addresses available (all are currently being used), it is called 'NAT pool exhaustion'.
# If a packet from another inside host arrives and needs NAT but there are no available addresses, the router will drop the packet.
# The host will be unable to access outside networks until one of the inside global IP addresses becomes available.
# Dynamic NAT entries will time out automatically if not used, or you can clear them manually.


## Dynamic NAT Configuration

# Define inside interfaces connected to the internal network
int g0/1
ip nat inside
exit
# Define outside interfaces connected to the external network
int g0/0
ip nat outside
exit

# Define the traffic that should be translated, permitted by the ACL
acccess-list 1 permit 192.168.0.0 0.0.0.255

# Define the pool of inside global IP addresses (instead of prefix-length 24, you can use netmask 255.255.255.0)
ip nat pool POOL1 100.0.0.0 100.0.0.255 prefix-length 24

# Configure dynamic NAT by mapping the ACL to the pool
ip nat inside source list 1 pool POOL1

# Clear NAT table. Only dynamic NAT translations will be cleared (static NAT entries will remain)
show ip nat translations

show ip nat statistics
# UDP and ICMP mappings are cleared about 1 minute later (statistics show as extended entries)
# The original dynamic mappings will be cleared after 24 hours (statistics show as dynamic entries)


## Dynamic PAT

# Port Address Translation (aka NAT overload) translates both the IP address and the port number (if necessary).
# By using a unique port number for each communication flow, a single public IP address can be used by many different internal hosts.
# Port numbers are 16 bits = over 65000 available port numbers.

# Inside local addresses (private IP on hosts) are translated to inside global (the public IP on the external interface)

# The router will keep track of which inside local address is using which inside global address and port.

# Because many inside hosts can share a single public IP, PAT is very useful for preserving public IP addresses, and it is used in networks all over the world.


## Configure PAT (pool)

# Define inside interfaces connected to the internal network
int g0/1
ip nat inside
exit
# Define outside interfaces connected to the external network
int g0/0
ip nat outside
exit

# Define the traffic that should be translated, permitted by the ACL
acccess-list 1 permit 192.168.0.0 0.0.0.255

# Define the pool of inside global IP addresses (instead of prefix-length 24, you can use netmask 255.255.255.0)
ip nat pool POOL1 100.0.0.0 100.0.0.255 prefix-length 24

# Configure PAT by mapping the ACL to the pool and using the overload keyword at the end
ip nat inside source list 1 pool POOL1 overload

show ip nat translations


## Configure PAT (interface)

# Define inside interfaces connected to the internal network
int g0/1
ip nat inside
exit
# Define outside interfaces connected to the external network
int g0/0
ip nat outside
exit

# Define the traffic that should be translated, permitted by the ACL
acccess-list 1 permit 192.168.0.0 0.0.0.255

# Configure PAT by mapping the ACL to the interface and enabling overload
ip nat inside source list 1 interface g0/0 overload

show ip nat translations


### Quality of Service (QoS) and Power over Ethernet (PoE)

## IP Phones
# Traditional phones operate over the Public Switched Telephone Network (PSTN).
# Sometimes this is called Plain Old Telephone Service (POTS).
# IP phones use Voice over IP (VoIP) technologies to enable phone calls over an IP network, such as the Internet.
# IP phones are connected to a switch just like any other end host.

# IP phones have an internal 3-port switch.
# 1 port is the uplink to the external switch
# 1 port is the downlink to the Procedure
# 1 port conencts internally to the phone itself

# This allows the PC and the IP phone to share a single switch port. Traffic from the PC passes through the IP phone to the switch.
# It is recommended to separate voice traffic (from the IP phone) and data traffic (from the PC) by placing them in separate VLANs.
# This can be accomplished using a voice VLAN
# Traffic from the PC will be untagged, but traffic from the phone will be tagged with a VLAN ID.

## Configure a switchport for IP phone and PC setup
interface g0/0
switchport mode access
switchport access vlan 10
switchport voice vlan 11

show interfaces g0/0 switchport

## Power over Ethernet (PoE)
# PoE allows Power Sourcing Equipment (PSE) to provide Powered Devices (PD) over an Ethernet cable.
# Typically the PSE is a switch and the PDs are IP phones, IP cameras, Wireless Access Points (WAPS), etc.
# The PSE receives AC power from the outlet, converts it to DC power, and supplies that DC power to the PDs.
# The same cables are also used to transmit data.
# Too much electrical current can damage electrical devices.
# PoE has a process to determine if a connected device needs power, and how much power it needs.
# When a device is connected to a PoE-enabled port, the PSE (switch) sends low power signals, monitors the response, and determines how much power the PD needs.
# If the device needs power, the PSE supplies the power to allow the PD to boot.
# The PSE continues to monitor the PD and supply the required amount of power (but not too much).

# Power policing can be configured to prevent a PD from taking too much power.
# Configure power policing with the default settings: disabled the port and send a Syslog message if a PD draws too much power.
power inline police 
# Equivalent to:
power inline police action err-disable
# The interface will be put in an error-disabled state and can be re-enabled with the shutdown command followed by the no shutdown command.
# The following command does not shut down the interface if the PD draws too much power. It will restart the interface and send a Syslog message.
power inline police action log

show power inline police g0/0

## PoE Standards

# Name | Standard | Watts | Powered Wire Pairs
# Cisco Inline Power (ILP) | Made by Cisco, not standard | 7 | 2
# PoE (Type 1) | 802.3af | 15 | 2
# PoE+ (Type 2) | 802.3.at | 30 | 2
# UPoE (Type 3) | 802.3.bt | 60 | 4
# UPoE+ (Type 4) | 802.3.bt | 100 | 4


## Quality of Service (QoS)
# Voice traffic and data traffic used to use entirely separate networks.
# Voice traffic used the PSTN
# Data traffic used the IP network (enterprise WAN, Internet, etc)

# QoS wasn't necessary as the different kinds of traffic didn't compete for bandwidth.

# Modern networks are typically converged networks in which IP phones, video traffic, regular data traffic, etc all share the same IP network.
# This enable  cost savings as well as more advanced features for voice and video traffic, for examples integrations with collaboration software (Cisco WebEx, Microsoft Teams, etc).
# However, the kinds of traffic now have to compete for bandwidth.
# QoS is a set of tools used by network devices to apply different treatment to different packets.

# QoS is used to manage the following characteristics of network traffic:
1) Bandwidth
# The overall capacity of the link, measured in bits per second (Kbps, Mbps, Gbps, etc)
# QoS tools allow you to reserve a certain amount of a link's bandwidth for specific kinds of traffic.
# For example: 20% voice traffic, 30% for specific kinds of data traffic, leaving 50% for all other traffic.
2) Delay
# The amount of time it takes traffic to go from source to destination = one-way delay
# The amount of time it takes traffic to go from source to destination and return = two-way delay
3) Jitter
# The variation in one-way delay between packets sent by the same application
# IP phones have a jitter buffer to provide a fixed delay to audio packets
4) Loss
# The percentage of packets sent that do not reach their destination
# Can be caused by faulty cables
# Can also be caused whe na device's packet queues get full and the device starts discarding packets.

# The following standards are recommended for acceptable interactive audio (ie. phone call) quality:
# One-way delay: 150 ms or less
# Jitter: 30 ms or less
# Loss: 1% or less

# If the standards are not met, there could be a noticable reduction in the quality of the phone call.

## QoS Queuing
# If a network device receives messages faster than it can forward them out of the appropriate interface, the messages are placed in a queue.
# By default, queued messages will be forwarded in a First In First Out (FIFO) manner.
# Messages will be sent in the order they are received.
# If the queue is full, new packets will be dropped. This is called tail drop.
# Tail drop is harmful because it can lead to TCP global synchronizaion.

# Review of the TCP sliding window:
# Hosts using TCP use the sliding window to increase / decrease the rate at which they send traffic as needed.
# When a packet is dropped, it will be re-transmitted.
# When a drop occurs, the sender will reduce the rate it sends traffic.
# It will then gradually increase the rate again.

# When the queue fills up and tail drop occurs, all TCP hosts sending traffic will slow down the rate at which they send traffic.
# They will all then increase the rate at which they send traffic, which rapidly leads to more congestion, dropped packets, and the process repeats again.

# Network congestion -> Tail drop -> Global TCP window size decrease -> Network underutilized -> Global TCP window size increase

# A solution to prevent tail drop and TCP global synchronizaion is Random Early Detection (RED).
# When the amount of traffic in the queue reaches a certain threshold, the device will start randomly dropping packets from select TCP flows.
# Those TCP flows that dropped packets will reduce the rate at which traffic is sent, but you will avoid global TCP synchronizaion, in which ALL TCP flows reduce and then increase the rate of transmission at the same time in waves.
# In standard RED, all kinds of traffic are treated the same.
# An improved version, Weighted Random Early Detection (WRED), allows you to control which packets are dropped depending on the traffic class.


## QoS Classification
# The purpose of QoS is to give certain kinds of network traffic priority over others during congestion.
# Classification organises network traffic (packets) into traffic classes (categories).
# Classification is fundamental to QoS. To give priority to certain types of traffic, you have to identify which types of traffic to give priority to.

# There are many methods of classifying traffic. Some examples:
# An ACL. Traffic which is permitted by the ACL will be given certain treatment, other traffic will not.
# Network Based Application Recognition (NBAR) performs a deep packet inspection, looking beyond the Layer 3 and Layer 4 information up to Layer 7 to identify the specific kind of traffic.
# In the Layer 2 and Layer 3 headers there are specific fields used for this purpose.

# The Priority Code Point (PCP) field of the 802.1Q tag (in the Ethernet header) can be used to indentify high / low priority traffic. Only when there is a dot1q tag.

# The Differentiated Services Code Point (DSCP) field of the IP header can also be used to identify high / low priority traffic.

# PCP is also known as Class of Service (CoS). Its use is defined by IEEE 802.1p
# 3 bits = 8 possible values (2^3 = 8)

# PCP Value | Traffic Types
# 0 | Best effort (default)
# 1 | Background
# 2 | Excellent effort
# 3 | Critical applications
# 4 | Video
# 5 | Voice
# 6 | Internetwork control
# 7 | Network control

# Best effort delivery means there is no guarantee that data is delivered or that it meets any QoS standard. This is regular traffic, not high priority.
# IP phones mark call signalling traffic (used to establish calls) as PCP3. They mark the actual voice traffic as PCP5.

# Because PCP is found in the dot1q header, it can only be used over the following connections:
# Trunk links
# Access links with a voice VLAN

## IP Precedence (IPP)
# Standard IPP markings are similar to PCP:
# 6 and 7 are reserved for network control traffic (ie. OSPF messages between routers)
# 5 = voice
# 4 = video
# 3 = voice signalling
# 0 = best effort

# With 6 and 7 reserved, 6 possible values remain
# Although 6 values is sufficient for many networks, the QoS requirements of some networks demand more flexibility.

## Differentiated Services Code Point (DSCP)
# RFC 2474 (1998) defines the DSCP field, and other DiffServ RFCs elaborate on its use.

# With IPP updated to DSCP, new standard markings had to be decided upon.
# By having generally agreed upon standard markings for different kinds of traffic, QoS design and implementation is simplified, QoS works better between ISPs and enterprises, among other benefits.

# You should be aware of the following standard markings:
# Default Forwarding (DF) - best effort traffic. The DSCP value for DF is 0.
# Expedited Forwarding (EF) - low loss / latency / jitter traffic (usually voice). The DSCP value for EF is 46. 
# Assured Forwarding (AF) - A set of 12 standard values. 
# Class Selector (CS) - A set of 8 standard values, provides backward compability with IPP

## Calculate AF values
# Defines 4 traffic classes. All packets in a class have the same priority. 
# Within each class, there are three levels of drop precedence. 
# Higher drop precedence = more likely to drop the packet during congestion.

# AF table
# | Class || Drop Precedence || 0 |
# | 4 | 2 | 1 || 2 | 1 || 0 |
# AF + Class + Drop Precedence

# DSCP table
# | 32 | 16 | 8 || 4 | 2 || 1 |
# DSCP + Binary addition

# Examples
# | 0 | 0 | 1 || 0 | 1 || 0 |
# = AF11
# = DSCP 10

# | 0 | 0 | 1 || 1 | 0 || 0 |
# = AF12
# = DSCP 12

# | 0 | 1 | 0 || 1 | 1 || 0 |
# = AF23
# = DSCP 22

# | 0 | 1 | 1 || 1 | 0 || 0 |
# = AF32
# = DSCP 28

# | 1 | 0 | 0 || 1 | 1 || 0 |
# = AF43
# = DSCP 38

# Formula to convert from AF value to decimal DSCP value:
# Class = X
# Drop Precedence = Y
# 8X + 2Y

# Example
# AF43
# DSCP = (8 x 4) + (2 x 3) = 32 + 6 = 38

## Summary of AF values

#                     Lowest drop precedence ----> Highest drop precedence
# Highest priority 
#                 ^   AF41 (34)   AF42 (36)   AF43 (38)
#                 |   AF31 (26)   AF32 (28)   AF33 (30)
#                 |   AF21 (18)   AF22 (20)   AF23 (22)
#                 |   AF11 (10)   AF12 (12)   AF13 (14)
# Lowest priority

# Traffic marked with AF41 gets the best treatment as it has the highest priority class and the lowest drop precedence
# Traffic marked with AF13 gets the worst treatment as it has the lowest priority class and the highest drop precedence

## Class Selector (CS)
# CS defines eight DSCP values for backward compability with IPP.
# Three bits that were added for DSCP are set to 0, and the original IPP bits are used to make 8 values.

# CS table
# | Decimal values || 0 | 0 | 0 |
# | 4 | 2 | 1 || 0 | 0 | 0 |
# IPP: 0 1 2 3 4 5 6 7
# CS: CS0 CS1 CS2 CS3 CS4 CS5 CS6 CS7
# DSCP is 8 x CS number
# DSCP: 0 8 16 24 32 40 48 56

## RFC 4954 (Standard Recommendations)
# RFC 4954 was developed with the help of Cisco to bring all of these values together and standardize their use.
# The RFC offers many specific recommendations, but here are a few key ones:

# Voice traffic: EF
# Interactive video: AF4x
# Streaming video: AF3x
# High priority data: AF2x
# Best effort: DF

## Trust Boundaries
# The trust boundary of a network defines where devices trust and don't trust the QoS markings of received messages.
# If the markings are trusted, the device will forward the message without changeing the markings.
# If the markings aren't trusted, the device will change the markings according to the configured policy.

# If an IP phone is connected to the switch port, it is recommended to move the trust boundary to the IP phones.
# This is done via configuration on the switch port connected to the IP phone.
# If a user marks their PC's traffic with a high priority, the marking will be changed (not trusted).

## Queuing and Congestion Management
# When a network device receives traffic at a faster rate than it can forward the traffic out of the appropriate interface, packets are placed in that interface's queue as they wait to be forwarded.
# When the queue becomes full, packets that don't fit in the queue are dropped (tail drop).
# RED and WRED drop packets early to avoid tail drop.

# An essential part of QoS is the use of multiple queues.
# This is where classification plays a role. The device can match traffic based on various factors (for example the DSCP marking in the IP header) and then place it in the appropriate queue.
# However, the device is only able to forward one frame out if an interface at once, so a scheduler is used to decide which queue traffic is forwarded from next.
# Prioritization allows the scheduler to give certain queues more priority than others.

# Process:
# Ingress traffic (routing, etc.) -> Classification -> Queuing -> Scheduling -> Transmission

# A common scheduling method is weighted round robin.
# Round robin = packets are taken from each queue in order, cyclically
# Weighted = more data is taken from high priority queues each time the scheduler reaches that queue

# Class-Based Weighted Fair Queuing (CBWFQ) is a popular method of scheduling, using a weighted round-robin scheduler while guaranteeing each queue a certain percentage of the interface's bandwidth during congestion.

# Round-robin scheduling is not ideal for voice and video traffic. Even if the voice and video traffic receives a guaranteed minimum amount of bandwidth, round-robin can add delay and jitter because even the high priority queues have to wait their turn in the scheduler.
# To resolve this, we can configure Low Latency Queuing (LLQ) that designates one (or more) queues as strict priority queues.
# This means that if there is traffic in the queue, the scheduler will always take the next packet from that queue until it is empty.
# This is very effective for reducing the delay and jitter of voice and video traffic.

# However, it has the downsite of potentially starving other queues if there is always traffic in the designated strict priority queue.
# Policing can control the amount of traffic allowed in the strict priority queue so that it can't take all of the link's bandwidth.

## Shaping and Policing
# Traffic shaping and policing are both used to control the rate of traffic.

# Shaping buffers traffic in a queue if the traffic rate goes over the configured rate.

# Policing drops the traffic if the traffic rate goes over the configured rate.
# Policing also has the option of re-marking the traffic instead of dropping it.
# Burst traffic over the configured rate is allowed for a short period of time.
# This accomodates data applications which typically are bursty in nature. Instead of a constant stream of data, they send data in bursts.
# The amound of burst traffic allowed is configurable.

# In both cases, classification can be used to allow for different rates for different kinds of traffic.


## QoS Configuration

# Free CCNA | QoS | Day 47 Lab | CCNA 200-301 Complete Course

# R1
configure terminal
# Identify traffic in a QoS configuration, we use class-map [name-matching-traffic]
class-map HTTPS_MAP
match protocol https
exit
class-map HTTP_MAP
match protocol http
exit
class-map ICMP_MAP
match protocol icmp
exit

show run | section class-map

# Specify what kind of treatment we want to give to each kind of traffic
policy-map G0/0/0_OUT
# Mark any https traffic
class HTTPS_MAP
# Decide what to do with traffic that matches this class map
set ip dscp AF31
# Give HTTPS a priority queue with at least 10% of the link's bandwidth during periods of congestion
priority percent 10
exit
class HTTP_MAP
set ip dscp af32
bandwidth percent 10
exit
class ICMP_MAP
set ip dhcp cs2
bandwidth percent 5
exit
exit

show run | section policy-map

# Apply the policy map using a service policy
interface G0/0/0
service-policy output G0/0/0_OUT
end

show run


### Security Fundamentals

# CIA Triad

# Confidentiality
# Only authorised users should be able to access data.
# Some information / data is public and can be accessed by anyone, some are secret and should only be accessed by specific people.

# Integrity
# Data should not be tampered with (modified) by Unauthorised users.
# Data should be correct and authentic.

# Availability
# The networks / systems should be operational and accessible to authorised users.

# Attackers can threaten the confidentiality, integrity, and availability of an enterise's system and information.

# A vulnerability is any potential weakness that can compromise the CIA of a system / info.
# A potential weakness is not a problem on its own.

# An exploit is something that can potentially be used to exploit the vulnerability.
# Something that can potentially be used as an exploit isn't a problem in it's own.

# A threat is the potential of a vulnerability to be exploited.
# A hacker exploiting a vulnerability in your system is a threat.

# A mitigation technique is something that can protect against threats.
# Should be implemented everywhere where a vulnerability can be exploited: client devices, servers, switches, routers, firewalls, etc.

## Types of Attacks

# Denial-of-Service (DoS) attacks
# One common DoS attack is the TCP SYN flood.
# TCP three-way handshake: SYN | SYN-ACK | X ACK
# The attacker sends countless TCP SYN messages to the target.
# The target sends a SYN-ACK message in response to each SYN it receives.
# The attacker never replies with the final ACK of the TCP three-way handshake.
# The incomplete connections fill up the target's TCP connection table.
# The attacker continues sending SYN messages.
# The target is no longer able to make legitimate TCP connections.

# The attacker likely spoofs their IP address so traffic from the target to the attacker will never reach.

# Distributed Denial-of-Service (DDoS) attack
# In a DDoS attack, the attacker infects many target computers with malware and uses them to initiate a DoS attack, for example a TCP SYN flood attack.
# This group of infected computers is called a botnet.

# Spoofing attacks
# To spoof an address is to use a fake source address (IP or MAC address)
# Numerous attacks involve spoofing, it's not a single kind of attack.
# An example is a DHCP exhaustion attack.
# An attacker uses spoofed MAC addresses to flood DHCP Discover messages.
# The target server's DHCP pool becomes full, resulting in a DoS to other devices.

# Reflection and Amplification attacks
# In a reflection attack, the attacker sends traffic to a reflector, and spoofs the source address of its packets using the target's IP address.
# The reflector (ie. a DNS server) sends the reply to the target's IP address.
# If the amount of traffic sent to the target is large enough, this can result in a DoS.
# A reflection attack becomes an amplification attack when the amount of traffic snet by the attacker is small, but it triggers a large amount of traffic to be sent from the reflector to the target.
# e.g. 
# https://www.cloudflare.com/learning/ddos/dns-amplification-ddos-attack
# https://www.cloudflare.com/learning/ddos/ntp-amplification-ddos-attack


# Man-in-the-middle (MITM) attack
# In PC1's ARP table, the entry for 10.0.0.1 will have the attacker's MAC address.
# When PC1 tries to send traffic to SRV1, it will be forwarded to the attacker instead.
# The attacker can inspect the messages, and then forward them on to SRV1.
# The attacker can also modify the messages before forwarding them to SRV1.
# This compromises the Confidentiality and Integrity of communications between PC1 and SRV1.

# Reconnaissance attacks
# These attacks are not attacks themselves, but they are used to gather information about a target which can be used for a future attack.
# This is often publicly available information.
# ie. nslookup to learn the IP address of a site.
# or a WHOIS query to learn email addresses, phone numbers, physical addresses, etc.
# https://lookup.icann.org/lookup

# Malware
# Malicious software refers to a variety of harmful programs that can infect a computer.
# Viruses infect other software (a host program). The virus spreads as the software is shared by users. Typically they corrupt or modify files on the target computer.
# Worms do not require a host program. They are standalone malware and they are able to spread on their own, without user interaction. The spread of worms can congest the network, but the payload of a worm can cause additional harm to target devices.
# Trojan Horses are harmful software that is disguised as legitimate software. They are spread through user interaction such as opening email attachments, or downloading a file from the Internet.

# Social Engineering attacks
# These attacks target the most vulnerable part of any system - people.
# They involve psychological manipulation to make the target reveal confidential information or perform some action.
# Phishing typically invilves fraudulent emails that appear to come from a legitimate business (Amazon, bank, credit card company, etc) and contain links to a fraudulent website that seems legitimate.
# Users are told to login to the fraudulent website, providing their login credentials to the attacker.
# Sprear phishing is a more targeted form of phishing, ie. aimed at employees of a certain company.
# Whaling is phishing targeted at high-profile individuals, ie. a company president.
# Vishing (voice phishing) is phishing performed over the phone.
# Smishing (SMS phishing) is phishing using SMS text messages.
# Watering hole attacks compromise sites that the target victim frequently visits. If a malicious link is placed on a website the target trusts, they might not hesitate to click it.
# Tailgating attacks involve entering restricted, secured areas by simply walking in behind an authorised person as they enter.
# Often the target will hold the door open for the attacker to be polite, assuming the attacker is also authorised to enter.

# Password-related attacks
# Most systems use a username / password combination to authenticate users.
# The username is often simple / easy to guess (for example the user's email address), and the strength and secrecy of the password is relied on to provide the necessary security.
# Attackers can learn a user's passwords via multiple methods:
# Guessing
# Dictionary attack: A program runs through a dictionary of list of common words / passwords to find the target's password.
# Brute force attack: A program tries every possible combination of letters, numbers, and special characters to find the target's password.
# Strong passwords should contain:
# at LEAST 8 characters (preferably more)
# a mixture of UPPERCASE and lowercase letters
# a mixture of letters and numbers
# one or more special characters (# @ ! ? etc.)
# passwords should be changed regularly

# Multi-factor authentication
# This involves providing more than just a username / password to prove your identity.
# It usually involves providing two of the following (two-factor authentication):
# Something you know: a username / password combination, a PIN, etc.
# Something you have: pressing a notification that appears on your phone, a badge that is scanned, etc.
# Something you are: biometrics such as a face scan, palm scan, fingerprint scan, retuna scan, etc.
# Requiring multiple factors of authentication greatly increases the security. Even if an attacker learns the target's password (something you know), they won't be able to login to the target's account.

# Digital certificates
# They are another form of atuhentication used to prove the identity of the holder of the certificate.
# They are used for websites to verify that the website being accessed is legitimate.
# Entities that want a certificate to prove their identity send a Certificate Signing Request (CSR) to a Certificate Authority (CA), which will generate and sign the certificate.

# Controlling and monitoring users with AAA
# AAA (triple-A) stands for Authentication, Authorisation, and Accounting.
# It is a framework for controlling and monitor users of a computer system (ie. a network).
# Authentication is the process of verifying a user's identity.
# Authorisation os the process of granting the user the appropriate access and permissions.
# Granting the user access to some files / services, restricting access to other files / services is authorisation.
# Accounting is the process of recording the user's activities on the system.
# Logging when a user makes a change to a file is accounting.
# Enterprises typically use a AAA server to provide AAA services.
# AAA servers usually support the following two AAA protocols:
# RADIUS: an open standard protocol, uses UDP ports 1812 and 1813.
# TACACS+: a Cisco propriety protocol, uses TCP port 49

# Security Program Elements
# User awareness programs are designed to make employees aware of potential security threats and risks.
# For example, a company might send out fales phishing emails to make employees click a link and sign in with their login credentials.
# Although the emails are harmless, employees who fall for the false emails will be informed that it is part of a user awareness program and they should be more careful about phishing emails.
# User training programs are more formal than user awareness programs.
# For example, dedicated training sessions which educate users on the corporate security policies, how to create strong passwords, and how to avoid potential threats.
# Physical access control protects equipment and data from potential attackers by only allowing authorised users into protected areas such as network closets or data center floors.
# Multifactor locks can protect access to restricted areas.
# ie. a door that requires users to swipe a badge and scan their fingerprint to enter.
# Permissions of the badge can easily be changed, for example permissions can be removed when an employee leaves the company.


### Port Security

# Port security is a security feature of Cisco switches.
# It allows you to controlwhich source MAC addresses are allowed to enter the switchport.
# If an unauthorised source MAC address enters the port, an action will be taken.
# The default action is to place the interface in an err-disabled state.

# When you enable port security on an interface with the default settings, one MAC address is allowed.
# You can configure the allowed MAC address manually.
# If you do not configure it manually, the switch will allow the first rouce MAC address that enters the interface.
# You can change the maximum number of MAC addresses allowed.

## Why port security?
# Port security allows network admins to control which devices are allowed to access the network.
# However, MAC address spoofing is a simple task.
# It's easy to configure a device to send frames with a different soruce MAC address.
# Rather than manually specifying the MAC addresses allowed on each port, port security's ability to limit the number of MAC addresses allowed on an interface is more useful.
# Think of the DHCP starvation attack.
# The attacker spoofed thousands of fake MAC addresses
# The DHCP server assigned IP addresses to these fake MAC addresses, exhausing the DHCP pool
# The switch's MAC address table can also become full due to such an attack
# Limiting the number of MAC addresses on an interface can protect agains those attacks.#

## Basic Port security configuration
interface g0/1
switchport port-security
# The command can be rejected if it is a dynamic port
do show int g0/1 switchport
# Port security can be enabled on access ports or trunk ports, but they must be statically configured as access or trunk.
switchport mode access
do show int g0/1 switchport
switchport port-security
# The command works so port security is now enabled on G0/1

show port-security interface g0/1

# If a port was shut down due to unauthorised devices connected, then re-enable it:
shutdown
no shutdown

# Errdisabled interfaces will not be automatically recovered
# Show errdisable reasons that can be enabled
show errdisable recovery

# Every 5 minutes (by default), all err-disabled interfaces will be re-enabled if err-disable recovery has been enabled for the cause of the interface's disablement.
# Enable err-disable recovery for port security violations
errdisable recovery cause psecure-violation
# Shorten the timer of the recovery
errdisable recovery interval 180

# ! ErrDisable Recovery is useless if you don't remove the device that caused the interface to enter the err-disabled state!
# Disconnect the unauthorised device, and either manually re-enable the interface, or let err-disable recovery do it for you automatically.
# What if you don't disconnect the unauthorised device?
# If you manually configured the MAC address, then the interface will become disabled again when it receives another frame from the unauthorised device.
# If you let the switch dynamically learn the previous secure MAC address, it is cleared when the interface is disabled. When the interface is re-enabled, the unauthorised device's MAC address might become the new secure MAC address on the interface, which is not a good situation.
# Remember to disconnect the unauthorised device.

## Port Security Violation Modes

# Shutdown 
# It shuts down the port by placing it in an err-disabled state.
# Generates a Syslog and/or SNMP message when the interface is disabled.
# The violation counter is set to 1 when the interface is disabled.

# Restrict
# The switch discards traffic from unauthorised MAC addresses.
# The interface is NOT disabled.
# Generates a Syslog and/or SNMP message each time an unauthorised MAC is detected.
# The violation counter is incremented by 1 for each unauthorised frame.

# Port Security Violation Mode: Restrict configuration
switchport port-security
switchport port-security mac-address 000a.000a.000a
switchport port-security violation restrict

# Protect
# The switch discards traffic from unauthorised MAC addresses.
# The interface is NOT disabled.
# It does NOT generate Syslog/SNMP messages for unauthorised traffic.
# It does NOT increment the violation counter.

# Port Security Violation Mode: Protect configuration
switchport port-security
switchport port-security mac-address 000a.000a.000a
switchport port-security violation protect

## Secure MAC address aging
# By default, secure MAC addresess will not age out (Aging Time: 0 mins).
# Can be configured with:
switchport port-security aging time [minutes]
# If the aging time is configured, the default aging type becomes Absolute.
# Absolute: After the secure MAC address is learned, the aging timer starts and the MAC is removed after the timer expires, even if the switch continues receiving frames from that source MAC address.
# Inactivity: After the secure MAC address is learned, the aging timer starts but it reset every time a frame from that source MAC address is received on the interface.
# Aging type is configured with:
switchport port-security aging type {absolute | inactivity}
# Secure Static MAC aging (addresses configured with 'switchport port-security mac-address x.x.x') is disabled by default.
# Can be enabled with:
switchport port-security aging static
# The statically assigned MAC address will be removed from the running-config and the MAC address table.
# Example configuration
switchport port-security aging time 30
switchport port-security aging type inactivity
switchport port-security aging static

## Sticky Secure MAC addresses
# Sticky secure MAC address learning can be enabled with the following command:
switchport port-security mac-address sticky
# When enabled, dynamically-learned secure MAC addresses will be added to the running config like this:
switchport port-security  mac-address sticky [mac-address]
# The sticky secure MAC addresses will NEVER age out.
# You need to save the running-config to the startup-config to make them truly permanent (or else they will not be kept if the switch restarts).
# When you issue the 'switchport port-security mac-address sticky' command, all current dynamically-learned secure MAC addresses will be converted to sticky secure MAc addresses.
# If you issue the 'no switchport port-security mac-address sticky' command, all current sticky secure MAC addresses will be converted to regular dynamically-learned secure MAC addresses.

# Sticky Secure MAC address configuration
switchport port-security
switchport port-security mac-address sticky
do show running-config interface g0/1
# Sticky MAC addresses are a way of configuring static secure MAC addresses without having to manually configure them.

## MAC Address Table
# Secure MAC addresses will be added to the MAC address table like any other MAC address.
# Sticky and Static secure MAC addresses will have a type of STATIC.
# Dynamically-learned secure MAC addresses will have a type of DYNAMIC.
# You can view all secure MAC addresses with:
show mac address-table secure

## Free CCNA | Port Security | Day 49 Lab | CCNA 200-301 Complete Course

# SW1 Config
conf t
int range f0/1-3
switchport mode access
switchport port-security
switchport port-security aging time 60

# SW2 Config
conf t
int g0/1
switchport mode access
switchport port-security
switchport port-security violation restrict
switchport port-security maximum 4
switchport port-security mac-address sticky

show port-sec int g0/1
show run
show mac address-table
show port-sec


### DHCP Snooping

# DHCP snooping is a security feature of switches that is used to filter DHCP messages received on untrusted ports.
# DHCP snooping only filters DHCP messages. Non-DHCP messages aren't affected.
# All ports are untrusted by default.
# Usually, uplink ports are configured as trusted ports, and downlink ports remain untrusted.

## DHCP Starvation
# An example of a DHCP-based attack is a DHCP starvation attack.
# An attacker uses spoofed MAC addresses to flood DHCP Discover messages.
# The target server's DHCP pool becomes full, resulting in a DoS to other devices.

## DHCP Poisoning (Man-in-the-Middle)
# Similar to ARP Poisoning, DHCP Poisoning can be used to perrform a Man-in-the-Middle attack.
# A spurious DHCP server replies to clients' DHCP Discover messages and assigns them IP addresses, but makes the client use the spurious server's IP as the default gateway.
# This will cause the client to send traffic to the attacker instead of the legitimate default gateway.
# The attacker can then examine / modify the traffic before forwarding it to the legitimate default gateway.

## DHCP Messages
# When DHCP Snooping filters messages, it differentiates between DHCP Server messages and DHCP Client messages.
# Messages sent by DHCP Servers:
# OFFER
# ACK
# NAK = Opposite of ACK, used to decline a client's REQUEST
# Messages sent by DHCP Clients:
# DISCOVER
# REQUEST
# RELEASE = Used to tell the server that the client no longer needs its IP address
# DECLINE = Used to decline the IP address offered by a DHCP server

## DHCP Snooping Operations
# If a DHCP message is received on a trusted port, forward it as normal without inspection.
# If a DHCP message is received on an untrusted port, inspect it and act as follows:
# If it is a DHCP Server message, discard it.
# If it is a DHCP Client message, perform the following checks:
# DISCOVER / REQUEST messages: Check if the frame's source MAC address and the DHCP message's CHADDR fields match. Match = forward, mismatch = discard
# RELEASE / DECLINE messages: Check if the packet's source IP address and the receiving interface match the entry in the DHCP Snooping Binding Table. Match = forward, mismatch = discard
# When a client successfully leases an IP address from a server, create a new entry in the DHCP Snooping Binding Table.

## DHCP Snooping Configuration

# SW2 - Distribution Layer
ip dhcp snooping
ip dhcp snooping vlan 1
no ip dhcp snooping information option
# Specify which ports to trust (interface pointing toward the DHCP server)
interface g0/0
ip dhcp snooping trust

# SW1 - Access Layer
ip dhcp snooping
ip dhcp snooping vlan 1
no ip dhcp snooping information option
# Specify which ports to trust (interface pointing toward the DHCP server)
interface g0/0
ip dhcp snooping trust

show ip dhcp snooping binding
# RELEASE / DECLINE messages will be checked to make sure their IP address / interface ID match the entry in the DHCP snooping table.

## DHCP SNooping Rate-Limiting
# DHCP snooping can limit the rate at which DHCP messages are allowed to enter an interface.
# If the rate of DHCP messages crosses the configured limit, the interface is err-disabled.
# Like with Port Security, the interface can be manually re-enabled, or automatically re-enabled with errdisable recovery.

# DHCP SNooping Rate-Limiting Configuration example
int r g0/1-3
ip dhcp snooping limit rate 1
# If the interfaces receive more than one DHCP message per second, it will be disabled (this is too low for a real network).

# Enable error disabled recovery for DHCP rate limiting
errdisable recovery cause dhcp-rate-limit

## DHCP Option 82 (Information Option)
# Option 82, also known as the DHCP relay agent information option is one of many DHCP options.
# It provides additional information about which DHCP relay agent received the client's message, on which interface, in which VLAN, etc.
# DHCP relay agents can add Option 82 to messages they forward to the remote DHCP server.
# With DHCP snooping enabled, by default Cisco switches will add Option 82 to DHCP messages they receive from clients, even if the switch isn't acting as a DHCP relay agent.
# By default, Cisco switches will drop DHCP messages with Option 82 that are received on an untrusted port.
no ip dhcp snooping information option

## Free CCNA | DHCP Snooping | Day 50 Lab | CCNA 200-301 Complete Course
# R1
conf t
ip dhcp excluded-address 192.168.1.1 192.168.1.9
ip dhcp pool POOL1
network 192.168.1.0 255.255.255.0
default-router 192.168.1.1

# SW1
conf t
ip dhcp snooping
ip dhcp snooping vlan 1
int g0/2
ip dhcp snooping trust
exit
no ip dhcp snooping information option

# SW2
conf t
ip dhcp snooping
ip dhcp snooping vlan 1
int g0/1
ip dhcp snooping trust
exit
no ip dhcp snooping information option


### Dynamic ARP Inspection

## ARP Review
# ARP is used to learn the MAC address of another device with a known IP address.
# For example, a PC will use ARP to learn the MAC address of its default gateway to communicate with external networks.
# Typically it is a tow message exchange: request and reply

## Gratuitous ARP
# A gratuitous ARP message is an ARP reply that is sent without receiving an ARP request.
# It is sent to the broadcast MAC address.
# It allows other devices to learn the MAC address of the sending device without having to send ARP requests.
# Some devices automatically send GARP messages when an interface is enabled, IP address is changed, MAC address is changed, etc.

## Dynamic ARP Inspection
# DAI is a security feature of switches that is used to filter ARP messages received on untrusted ports.
# DAI only filters ARP messages. Non-ARP messages aren't affected.
# All ports are untrusted by default.
# Typically, all ports connected to other network devices (switches, routers) should be configured as trusted, while interfaces connected to end hosts should remain untrusted.

## ARP Poisoning (Man-in-the-Middle)
# Similar to DHCP poisoning, ARP poisoning involves an attacker manipulating target's ARP tables so traffic is sent ot the attacker.
# To do this, the attacker can send gratuitous ARP messages using another device's IP address.
# Other devices in the network will receive the GARP and update their ARP tables, causing them to send traffic to the attacker instaed of the legitimate destination.

## Dynamic ARP Inspection Operations
# DAI inspects the sender MAC and sender IP fields of ARP messages received on untrusted ports and checks that there is a matching entry in the DHCP snooping binding table.
# If there is a matching entry, the ARP message is forwarded normally.
# If there isn't a matching entry, the ARP message is discarded.
# DAI doesn't inspect messages received on trusted ports. They are forwarded as normal.
# ARP ACLs can be manually configured to map IP address / MAC addresses for DAI to check.
# Useful for hosts that don't use DHCP.
# DAI can be configured to perform more in-depth checks also, but these are optional.
# like DHCP snooping, DAI also supports rate-limiting to prevent attackes from overwhelming the switch with ARP messages.
# DHCP snooping and DAi both require work from the switch's CPU.
# Even if the attacker's messages are blocked, they can overload the switch CPU with ARP messages.

## DAI Configuration
# SW1
ip arp inspection vlan 1
int r g0/0-1
ip arp inspection trust

# DHCP snooping requires two commands to enable it:
ip dhcp snooping
ip dhcp snooping vlan [vlan-number]
# DAI only requires one:
ip arp inspection vlan [vlan-number]

show ip arp inspection interfaces

# DAI rate limiting is enabled on untrusted ports by default with a rate of 15 packets per second.
# It is disabled on trusted ports by default.
# DHCP snooping rate limiting is disabled on all interfaces by default.
# DHCP snooping rate limiting is configured like this: [x packets per second]
# The DAI burst interval allows you to configure rate limiting like this: [x packets per y seconds]

## DAI Rate Limiting Configuration
# SW1
int r g0/1-2
ip arp inspection limit rate 25 burst interval 2
# The burst interval is optional. If you don't specify it, the default is 1 second.
int r g0/3
ip arp inspection limit rate 10
# If ARP messages are received faster than the specified rate, the interface will be err-disabled.
# It can be re-enabled in two ways:
# 1. [shutdown] and [no shutdown]
# 2. [errdisable recovery cause arp-inspection]

show ip arp inspection interfaces

## DAI Optional Checks
ip arp inspection validate [dst-mac]
ip arp inspection validate [ip]
ip arp inspection validate [src-mac]

# dst-mac: Enables validation of the destination MAC address in the Ethernet header agains the target MAC address in the ARP body for ARP responses. The device classifies packets with different MAC addresses as invalid and drops them.
# ip: Enables validation of the ARP body for invalid and unexpected IP addresses. Addresses include 0.0.0.0, 255.255.255.255, and all IP multicast addresses.
# The device checks the sender IP addresses in all ARP requests and responses and checks the target IP addresses only in ARP responses.
# src-mac: Enables validation of the source MAC address in the Ethernet header against the sender MAC address in the ARP body for ARP requests and responses.
# The devices classifies packets with different MAC addresses as invalid and drops them.

show run | include validate

# You must enter all of the validation checks you want in a single command. Specify one, two, or all three. The order isn't significant.
ip arp inspection validate src-mac dst-mac ip

## ARP ACLs
arp access-list ARP-ACL-1
permit ip host 192.168.1.100 mac host 0c29.2f1e.7700
exit
# Apply the ACL
ip arp inspection filter ARP-ACL-1 vlan 1
# The IP is forwarded even though there is no entry in the DHCP snooping binding table.

show ip arp inspection

## Free CCNA | Dynamic ARP Inspection | Day 51 Lab | CCNA 200-301 Complete Course
# R1
conf t
ip dhcp excluded-address 192.168.1.1 192.168.1.9
ip dhcp pool POOL1
network 192.168.1.0. 255.255.255.0
default-router 192.168.1.1

# SW1
conf t
# Enables command globally
ip dhcp snooping
# Also needs to be enabled per VLAN
ip dhcp snooping vlan 1
no ip dhcp snooping information option
int g0/2
ip dhcp snooping trust
exit
ip arp inspection vlan 1
ip arp inspection validate dst-mac ip src-mac
int r g0/1-2
ip arp inspection trust
end

# SW2
conf t
ip dhcp snooping
ip dhcp snooping vlan 1
no ip dhcp snooping information option
int g0/1
ip dhcp snooping trust
exit
ip arp inspection vlan 1
ip arp inspection validate dst-mac ip src-mac
int g0/1
ip arp inspection trust
end

show run
show ip arp inspection interfaces


### Free CCNA | STP & FHRP Synchronization | Day 52 Lab | CCNA 200-301 Complete Course
# (Good LAN design principle)

## HSRP and STP synchronizaion means that the HSRP active should be the STP root bridge, and the HSRP standby should be the STP secondary root bridge.
# Why should the HSRP active and the STP root be synchronized or aligned?
# It is to ensure that traffic from the end hosts frollows the most direct path to the default gateway.
# If the HSRP active router is not the STP root, then traffic from PC1 to DSW1 might not take the direct path to DSW1, it might take a longer path.
# This is not a disaster, but obviously not ideal.
# Because STP works by finding the shortest path to the root, ensuring that the HSRP active router is synchronized with the STP root means that traffic will follow the most efficient path.
# In this lab, we will make DSW1 the HSRP active and STP root for VLAN 10, and make DSW2 the HSRP active and STP root for VLAN20.

# DSW1
conf t
spanning-tree vlan 10 root primary
spanning-tree vlan 20 root secondary

do show span vlan 10
do show span vlan 20

int vlan 10
standby version 2
standby 10 ip 10.0.10.254
standby 10 priority 105
standby 10 preempt

int vlan 20
standby version 2
standby 20 ip 10.0.10.254
standby 20 priority 95
standby 20 preempt
end

# DSW2
conf t
spanning-tree vlan 10 root secondary
spanning-tree vlan 20 root primary

do show span vlan 10
do show span vlan 20

int vlan 10
standby version 2
standby 10 ip 10.0.10.254
standby 10 priority 95
standby 10 preempt

int vlan 20
standby version 2
standby 20 ip 10.0.10.254
standby 20 priority 105
standby 20 preempt
end

show standby brief


### WAN Architectures

# WAN stands for Wide Area Network. A WAN is a network that extends over a large geographic area.
# WANs are used to connect geographically separate LANs.
# Although the Internet itself can be considered a WAN, the term WAN is typically used to refer to an enterprise's private connections that connect their offices, data centres, and other sites together.
# Over public / shared networks like the Internet, Virtual Private Networks (VPNs) can be used to create private WAN connections.
# There have been many different WAN technologies over the years. Depending on the location, some will be available and some will not be.
# Technologies which are considered legacy (old) in one country might still be used in other countries.

## Multi Protocol Label Switching (MPLS)
# Similar to the Internet, service provider's MPLS networks are shared infrastucture because many customer enterprises connect to and share the same infrastucture to make WAN connections.
# However, the label switching in the name of MPLS allows VPNs to be created over the MPLS infrastucture through the use of labels.
# Some important terms:
# CE router = Customer Edge router
# PE router = Provider Edge router
# P router = Provider core router
# When the PE routers receive frames from the CE routers, they add a label to the frame.
# These labels are used to make forwarding decisions within the service provider network, not the destination IP.

## Layer 3 MPLS VPN
# The CE routers do not use MPLS, it is only used by the PE/P routers.
# When using a Layer 3 MPLS VPN, the CE and PE routers peer using OSPF, for example, to share routing information.

## Layer 2 MPLS VPN
# When using a Layer 2 MPLS VPN, the CE and PE routers do not form peerings.
# The service provider network is entirely transparent to the CE routers.
# In effect, it is like the two CE routers are directly connected.
# If a routing protocol is used, the two CE routers will peer directly with each other.

# Many different technologies can be used to connect to a service provider's MPLS network for WAN service.
# Ethernet (Fiber)
# LTE (4G/5G)
# CATV (Cable TV)
# Serial

## Internet Connections
# There are countless ways for an enterprise to connect to the Internet.
# For example, private WAN technologies such as leased lines and MPLS VPNs can be used to connect to a service provider's Internet infrastucture.
# In addition, technologies such as CATV and DSL commonly used by consumers (home Internet access) can also be used by an Enterprise.
# These days, for both enterprise and consumer Internet access, fibre optic Ethernet connections are growing in popularity due to the high speeds they provide over long distances.

## Digital Subscriber Line (DSL)
# DSL provides Internet connectivity to customers over phone lines, and can share the same phone line that is already installed in most homes.
# A DSL modem (modulator-demodulator) is required to convert data into a format suitable to be sent over the phone lines.
# The modem might be a separate device, or it might be incorporated into the home router.

## Cable Internet
# Cable Internet provides Internet access via the same CATV (Cable Television) lines used for TV service.
# Like DSL, a cable modem is required to convert data into a format suitable to be sent over the CATV cables.
# Like a DSL modem, this can be a separate device or built into the home router.

## Redundant Internet Connections
# Single Homed = 1 connection to 1 ISP
# Dual Homed = 2 connections to 1 ISP
# Multihomed = 1 connection to each of 2 ISPs
# Dual Multihomed = 2 connections to each of 2 ISPs

## Internet VPNs
# Private WAN services such as leased lines and MPLS provide security because each customer's traffic is separated by using dedicated physical connections (leased line) or by MPLS tags.
# When using the Internet as a WAN to connect sites together, there is no built-in security by default.
# To provide secure communications over the Internet, VPNs are used.
# Two kinds of Internet VPNs:
# 1) Site-to-Site VPNs using IPSec
# 2) Remote-access VPNs using TLS

## Site-to-Site VPNs (IPsec)
# A site-to-site VPN is a VPN between two devices and is used to connect two sites together over the Internet.
# A VPN tunnel is created between the two devices by encapsulating the original IP packet with a VPN header and a new IP header.
# When using IPsec, the original packet is encrypted before being encapsulated with the new header.

# Example:
# A PC at office A wants to send traffic to the PC at office B over an IPsec VPN tunnel, so it first sends the unencrypted data to its default gateway, the router.
# The router encrypts the data, and adds a VPN header and new IP header.
# Then the encrypted data in the new packet is sent over the Internet to the other end of the tunnel.
# The receiving router decrypts the data, and sends it to the destination PC.
# That is a very basic overview of how IPsec VPNs work.

# Summarise the process:
# 1) The sending device combines the original packet and session key (encryption key) and runs them through an encryption formula.
# 2) The sending device encapsulates the encrypted packet with a VPN header and a new IP header.
# 3) The sending device sends the new packet to the device on the other side of the tunnel.
# 4) The receiving device decrypts the data to get the original packet, and then forwards the original packet to its destination.
# In a site-to-site VPN, a tunnel is formed only between two tunnel endpoints (for example, the two rotuers conencted to the Internet).
# All other devices in each site don't need to create a VPN for themselves. They can send unencrypted data to their site's router, which will encrypt it and forward it in the tunnel as described above.

# There are some limitations to standard IPsec:
# 1) IPsec does not support broadcase and multicast traffic, only unicast. This means that routing protocols such as OSPF cannot be used over the tunnels, because they rely on multicast traffic.
# This can be solved with 'GRE over IPsec'.
# 2) Configuring a full mesh of tunnels between many sites is a labor-intensive task.
# This can be solved with Cisco's DMVPN.

## Generic Routing Encapsulation (GRE) over IPsec
# GRE creates tunnels like IPsec, however it does not encrypt the original packet, so it is not secure.
# However, it has the advantage of being able to encapsulate a wide variety of Layer 3 protocols as well as broadcase and multicast messages.
# To get the flexibility of GRE with the security of IPsec, GRE over IPsec can be used.
# The original packet will be encapsulated by a GRE header and a new IP header, and then the GRE packet will be encrypted and encapsulated within an IPsec VPN header and new IP header.

# | Encrypted { | IP Packet | GRE Header | IP Header | } | IPsec VPN Header | IP Header |

## Dynamic Multipoint VPN (DMVPN)
# DMVPN is a Cisco-developed solution that allows routers to dynamically create a full mesh of IPsec tunnels without having to manually configure every single tunnel.
# 1) Configure IPsec tunnels to a hub site.
# 2) The hub router gives each router information about how to form an IPsec tunnel with the other routers.
# DMVPN provides the configuration simplicity of hub-and-spoke (each spoke router only needs one tunnel configured) and the efficiency of direct spoke-to-spoke communication (spoke routers can communicate directly without traffic passing through the hub).

## Remote-access VPNs
# Whereas site-to-site VPNs are used to make a point-to-point connection between two sites over the Internet, remote-access VPNs are used to allow end devices (PCs, mobile phones) to access the company's internal resources securely over the Internet.
# Remote-access VPNs typically use TLS (Transport Layer Security).
# TLS is also what provides security for HTTPS (HTTP Secure)
# TLS was formerly known as SSL (Secure Sockets Layer) and developed by Netscape, but it was renamed to TLS when it was standardised by the IETF.
# VPN client software (for example Cisco AnyConnect) is installed on end devices (for example company-provided laptops that employees use to work from home).
# These end devices then form secure tunnels to one of the company's routers / firewalls acting as a TLS server.
# This allows the end users to securely access resources on the company's internal network without being directly connected to the company network.

## Site-to-Site vs Remote-Access VPN
# Site-to-Site VPNs typically use IPsec.
# Remote-Access VPNs typically use TLS.

# Site-to-Site VPNs provide service to many devices within the sites they are connecting.
# One IPsec tunnel between two routers or firewalls provides traffic security for all hosts within the sites they are connecting.
# Remote-Access VPNs provide service to the one end device the VPN client software is installed on.
# Instead of connecting two sites together, they connect one end device to a site.

# Site-to-Site VPNs are typically used to permanently connect two sites over the Internet.
# Remote-Access VPNs are typically used to provide on-demand access for end devices that want to securely access comapny resources while connected to a network which is not secure.


## Free CCNA | GRE Tunnels | Day 53 Lab | CCNA 200-301 Complete Course

# Topology:
# | R1 |-| SPR1 |-| SPR2 |-| R2 |

# R1
conf t
# Create a virtual tunnel interface
int tunnel 0
# Specify which physical interface on R1 will be used for the tunnel
tunnel source g0/0/0 # preferable remote IP address
# Destination is R2 WAN interface IP
tunnel destination 200.0.0.2
# The tunnel interface itself needs an IP address
ip address 192.168.1.1 255.255.255.252
# Configure a default route to R2
ip route 0.0.0.0 0.0.0.0 100.0.0.1
# Enable OSPF so hosts can communicate between branches
router ospf 1
network 192.168.1.1 0.0.0.0 area 0
network 10.0.1.1 0.0.0.0 area 0
passive-interface g0/0

# R2
conf t
# Create a virtual tunnel interface
int tunnel 0
# Specify which physical interface on R2 will be used for the tunnel
tunnel source g0/0/0 # preferable remote IP address
# Destination is R1 WAN interface IP
tunnel destination 100.0.0.2
# The tunnel interface itself needs an IP address
ip address 192.168.1.2 255.255.255.252
# R2 does not know how to reach the IP address we specified as the tunnel destination 100.0.0.2
# If R2 does not know how to get to 100.0.0.2, it cannot build a GRE tunnel to 100.0.0.2.
# Configure a default route to R1
ip route 0.0.0.0 0.0.0.0 200.0.0.1
# Enable OSPF so hosts can communicate between branches
router ospf 1
network 192.168.1.2 0.0.0.0 area 0
network 10.0.2.1 0.0.0.0 area 0
passive-interface g0/0

do show ip int brief
do show ip route


