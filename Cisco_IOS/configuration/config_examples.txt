### Cisco_IOS ###


### Configure Hostname

conf t
hostname R1
do sh run | inc host


### Configure Interface with IP address

interface FastEthernet0/0
ip address 10.1.1.1 255.255.255.0
no shutdown


### Set Up an IOS Router or Switch as SSH Client

# There are four steps required to enable SSH support on a Cisco IOS:

# 1. Configure the hostname command.
# 2. Configure the DNS domain.
# 3. Generate the SSH key to be used.
# 4. Enable SSH transport support for the virtual type terminal (vtys).

configure terminal
hostname R1
ip domain name cisco.com
username admin privilege 15 password Cisco123
line con 0
password cisco
login
exit
line vty 0 4
password cisco
login local
logging synchronous
transport input all
exit
line vty 5 15
password cisco
login local
logging synchronous
transport input all
exit
crypto key generate rsa
1024
ip ssh version 2
banner motd # Unauthorised access is strictly prohibited! #
end
wr


### Standard ACL

# access-list number { deny | permit } ip wildcard-mask
access-list 1 deny 1.1.1.1 0.0.0.0
access-list 1 deny 1.1.1.1
access-list 1 deny host 1.1.1.1
access-list 1 permit any
access-list 1 permit 0.0.0.0 255.255.255.255
access-list 1 remark ## BLOCK PERSON FROM ACCOUNTING ##

show access-lists
show ip access-lists

# Permit a single host from a subnet
access-list 1 permit 192.168.1.1
access-list 1 deny 192.168.1.0 0.0.0.255
interface g0/1
ip access-group 1 out

# Named ACL
ip access-list standard { acl-name }
[ entry number ] { deny | permit } ip wildcard-mask


### Better ACL Config

# Standard ACL
# Numbered ACL Ranges: 100-199, 2000-2699

ip access-list standard 1
# or
ip access-list standard BLOCK_PC1
deny 192.168.1.1
permit any
do show access list
# delete an entry
no 30

# insert a new entry by specifying the sequence number
30 deny 192.168.2.0 0.0.0.255

# resequence ACLs
# ip access-list resequence [acl-id] [starting-seq-num] [increment]
# [starting-seq-num] = change the sequence number of the first entry to 10
# [increment] = add 10 for every entry after that
ip access-list resequence 1 10 10

# NOTE - When configuring or editing numbered ACLs from global config mode,
# you cannot delete individual entries, you can only delete the entire ACL!


### Extended ACLs

# Extendend Numbered ACL
# access-list [number] (permit | deny) [protocol] [src-ip] [dest-ip]

# Extended Named ACL
# ip access-list extended (name | number)
# [seq-num] (permit | deny) [protocol] [src-ip] [dest-ip]
ip acccess-list extended DENY_VLAN10
deny tcp any 10.0.0.0 0.0.0.255

# examples
# allow all traffic
permit ip any any
# prevent 10.0.0.0/16 from sending UDP traffic to 192.168.1.1/32
deny udp 10.0.0.0 0.0.255.255 host 192.168.1.1
# prevent 172.16.1.1/32 from pinging hosts in 192.168.0.0/24
deny icmp host 172.16.1.1 192.168.0.0 0.0.0.255
# When matching TCP or UDP, you can optionally specify the source and/or destination port numbers to match
deny tcp [src-ip] eq [src-port-num] [dest-ip]
deny tcp 10.1.1.1 eq 80 10.2.2.2
# eq 80 = equal to port 80
# gt 80 = greater than 80 (<81)
# lt 80 = less than 80 (>79)
# neq 80 = NOT 80
# range 80 100 = port from 80 to port 100

# After the destination IP address and/or port numbers, there are more options you can use to match
# ack = match TCP ACK flag
# fin = match TCP FIN flag
# syn = match TCP SYN flag
# ttl = match packets with a specific TTL value
# dscp = match packets with a specific DSCP value

# examples
# allow traffic from 10.0.0.0/16 to access the server at 2.2.2.2/32 using HTTPS
permit tcp 10.0.0.0 0.0.255.255 2.2.2.2 0.0.0.0 eq 443
# prevent all hosts using source UDP port numbers from 20000 to 30000 from accessing the server at 3.3.3.3/32
deny udp any range 20000 30000 host 3.3.3.3
# allow hosts in 172.16.1.0/24 using a TCP source port greater than 9999 to access all TCP ports on server 4.4.4.4/32 except port 23
permit tcp 172.16.1.0 0.0.0.255 gt 9999 host 4.4.4.4 neq 23

# Applying Extended ACLs to interfaces
# Note - Extended ACLs should be applied as close to the soruce as possible to limit how far the packets travel in the network before being denied. Standard ACLs are less specific, so if they are applied close to the source there is a risk of blocking more than intended.

interface g0/1
ip access-group HTTP_SRV1 in

# Prevent R1 from forwarding OSPF packets out of G0/2
ip access-list extended 112
deny 89 any any
permit ip any any
interface g0/2
ip access-group 112 out


### Static Routing

# ip route [ remote network ] [ remote network subnet ] [ neighbour interface ]
ip route 10.1.1.0 255.255.255.0 10.1.2.1

### OSPF Dynamic Routing

OSPF Neighbour Requirements

1. Area must match
2. Area must be in the same subnet
3. OSPF process must not be sutdown
4. OSPF Router IDs must be unique
5. Hello and Dead timers must match
6. Autohentication settings must match
7. IP MTU settings must match
8. OSPF Network Type must match


OSPF Types of LSA

Type 1 (Router LSA)
- Every OSPF rotuer generates this type of LSA.
- It identifies the router using its router ID.
- It also lists networks attached to the rotuer's OSPF-activated interfaces.

Type 2 (Network LSA)
- Generated by the DR of each 'multi-access' network (ie. the broadcast network type).
- Lists the routers which are attached to the multi-access network.

Type 5 (AS External LSA)
- Generated by ASBRs to describe routes to destinations outside of the AS (OSPF domain).


### Subinterfaces for Router on a Stick

# On R1
int g0/0.10
encapsulation dot1Q 10
ip address 10.0.0.62 255.255.255.192

int g0/0.20
encapsulation dot1Q 20
ip address 10.0.0.216 255.255.255.192

# On SW1
int g0/0
switchport mode trunk
exit
vlan 10
name VLAN-A
vlan 20
name VLAN-B
int f0/1
switchport mode access
switchport access vlan 10
exit
int f0/2
switchport mode access
switchport access vlan 20
exit

show vlans


### Etherchannel

# LACP SW1
int range g0/1-2
channel-group 1 mode active
exit
int po1
switchport trunk encapsulation dot1q
switchport mode trunk

# LACP SW2
int range g0/3-4
channel-group 1 mode active
exit
int po1
switchport trunk encapsulation dot1q
switchport mode trunk

# Static Etherchannel
# DSW1
int range g0/1-2
no switchport
channel-group 2 mode on
int po2
ip add 10.0.0.1 255.255.255.252

# DSW2
int range g0/1-2
no switchport
channel-group 2 mode on
int po2
ip add 10.0.0.2 255.255.255.252

show etherchannel summary

# Etherchannel load-balance
port-channel load-balance src-dst-ip

show etherchannel load-balance


### HSRP

# R1
int g0/0
standby version 2
standby 1 ip 10.0.1.254
standby 1 pirority 200
standby 1 preempt

# R2
int g0/0
standby version 2
standby 1 ip 10.0.1.254
standby 1 pirority 50

show standby


### CDP

# Enable / disable CDP globally
[no] cdp run

# Enable / disable CDP on specirfic interfaces
interface g0/1
[no] cdp enable

# Configure the CDP timer
cdp timer (seconds)

# Configure the CDP holdtime
cdp holdtime (seconds)

# Enable / disable CDPv2
[no] cdp advertise-v2

# CDP show commands
show cdp
show cdp traffic
show cdp interface
show cdp  neighbours
show cdp detail
show cdp entry (name)


### LLDP

# Enable / disable LLDP
[no] lldp run

# Enable / disable LLDP on specirfic interfaces (tx)
int g0/1
[no] lldp transmit

# Enable / disable LLDP on specirfic interfaces (rx)
int g0/1
[no] lldp receive

# Configure the LLDP timer
lldp timer (seconds)

# Configure the LLDP holdtime
lldp holdtime (seconds)

# Configure the LLDP reinit timer
lldp reinit (seconds)

# LLDP show commands
show lldp
show lldp traffic
show lldp interface
show lldp  neighbours
show lldp detail
show lldp entry (name)


### NTP

# The most important reason to have accurate time on a device
# is to have accurate logs for troubleshooting.

show clock
show clock detail
show calendar

# Manual clock configuration (Internal clocks will drift, so it is not ideal)
clock set 14:30:00 27 July 2022
clock timezone GMT 0
ntp update-calendar

# Configure NTP servers
ntp server 216.239.35.0
ntp server 216.239.35.4
ntp server 216.239.35.8
ntp server 216.239.35.12

show ntp status
show ntp associations

# NTP authentication

# R1
ntp authenticate
ntp authentication-key 1 md5 myCiscoLab
ntp trusted-key 1

# R2
ntp authenticate
ntp authentication-key 1 md5 myCiscoLab
ntp trusted-key 1
ntp server 10.0.12.1 key 1
ntp peer 10.0.23.2 key 1

# R3
ntp authenticate
ntp authentication-key 1 md5 myCiscoLab
ntp trusted-key 1
ntp server 10.0.12.1 key 1
ntp peer 10.0.23.1 key 1


### DHCP

# Configure a router to act as a DHCP Server

ip dhcp excluded-address 192.168.1.1 192.168.1.10
ip dhcp pool LAB_POOL
network 192.168.1.0 255.255.255.0
dns-server 8.8.8.8
domain-name cisco.com
default-router 192.168.1.1
# lease [days] [hours] [minutes]
lease 0 5 30
# lease infinite

show ip dhcp binding
show ip dhcp server statistics

# Configure a router to act as a DHCP Relay Agent

interface g0/1
ip helper-address 192.168.10.10

show ip interface g0/1

# Configure a router to be a DHCP Client

interface g0/1
ip address dhcp

sh ip interface g0/1


### SNMP

http://oid-info.com/

# SNMP Agent port = UDP 161
# SNMP Manager port = UDP 162

## SNMP Read Messages
# Messages sent by the NMS to read information from the managed devices.

# Get - A request sent from the manager to the agent to retrieve the value of a variable (OID), or multiple variables.
# The agent will send a Response message with the current value of each variable.

# GetNext - A request sent from the manager to the agent to discover the available variables on the MIB.

# GetBulk - A more efficient version of the GetNext message (introduced in SNMPv2).

## SNMP Write Messages
# Messages sent by the NMS to change information on the managed devices.

# Set - A request sent from the manager to the agent to change the value of one or more variables.
# The agent will send a Response message with the new values.

## SNMP Notification
# Messages sent by the managed devices to alert the NMS of a particular event.

# Trap - A notification sent from the agent to the manager. 
# The manager does not send a Response message to acknowledge that it received the Trap, so these messages are unreliable.

# Inform - A notification message that is acknowledged with a Response message.
# Originally used for communications between managers, but later updates allow agents to send Inform messages to managers too.

## SNMP Response
# Messages sent in response to a previous message/request.


## SNMPv2c Configuration

snmp-server contact example@google.com
snmp-server location "Rack B1"
snmp-server community CCNA1 ro
snmp-server community CCNA2 rw
# Specify the address of the NMS (version and which community string to use)
snmp-server host 192.168.1.1 version 2c CCNA1
# Traps will be sent if an interface goes up or down
snmp-server enable traps snmp linkdown linkup
# Traps will be sent if configuration changes are made
snmp-server enable traps config

show snmp community
show snmp contact
show snmp host
show snmp location


## SNMPv3 Configuration

Username: UserJustMe
Authentication Password: AuthPass1
Privacy Password: PrivPass2
View Name: ViewDefault
Group Name: GrpMonitoring

# IOS & IOS-XE
snmp-server view ViewDefault iso included
snmp-server group GrpMonitoring v3 priv read ViewDefault
snmp-server user UserJustMe GrpMonitoring v3 auth sha AuthPass1 priv aes 128 PrivPass2

# IOS-XR
snmp-server view ViewDefault iso included 
snmp-server group GrpMonitoring v3 priv read ViewDefault
snmp-server user UserJustMe GrpMonitoring v3 auth sha AuthPass1 priv aes 128 PrivPass2

# Nexus Switch (OS-NX)
snmp-server user UserJustMe network-admin v3 auth sha AuthPass1 priv aes-128 PrivPass2

# ASA firewall
snmp-server group GrpMonitoring v3 priv
snmp-server user UserJustMe GrpMonitoring v3 auth sha AuthPass1 priv aes 128 PrivPass2
snmp-server host mgmt 10.1.1.161 version 3 UserJustMe

# Testing SNMPv3 configuration with Net-SNMP
# apt-get install snmp
snmpwalk -v3 -l authPriv -u UserJustMe -a SHA -A AuthPass1 -x AES -X PrivPass2 10.7.1.9:161 sysDescr


### Syslog

# Syslog server port (listen) = UDP 514

# seq:time stamp: %facility-severity-MNEMONIC:description
# [sequence number]:[timestamp]: %[which process]-[severity number]-[short message]:[detailed information]

# Examples
# *Feb 11 03:02:55.304: %LINK-3-UPDOWN: Interface GigabitEthernet0/0, changed state to up
# *Feb 11 03:02:55.304: %OSPF-5-ADJCHG: Process 1, Nbr 192.168.1.2 on GigabitEthernet0/0 from LOADING to FULL, Loading Done
# *Feb 11 03:02:55.304: %SYS-5-CONFIG_I: Configured from console by admin on console
# *Feb 11 03:02:55.304: %SYS-6-CLOCKUPDATE: System clock has been updated from 07:27:23 UTC Thu Feb 11 2021 to 16:27:23 JST Thu Feb 11 2021, configured from console by admin on console.

# Syslog severity levels
# Level - Keyword - Description
# 0 - Emergency - System is unusable
# 1 - Alert - Action must be taken immediately
# 2 - Critical - Critical conditions
# 3 - Error - Error conditions
# 4 - Warning - Warning conditions
# 5 - Notice - Normal but significant conditions
# 6 - Informational - Informational messages
# 7 - Debugging - Debug-level messages

# Memorize the severity levels
# Every Awesome Cisco Engineer Will Need Icecream Daily

## Syslog Logging Locations

# Console line: Syslog messages will be displayed in the CLI when connected to the device via the console port. All messages are displayed by default.

# VTY lines: Syslog messages will be displayed in the CLI when connected to the device via Telnet or SSH. Disabled by default.

# Buffer: Syslog messages will be saved to RAM. All messages will be displayed by default.

# External server: You can configure the device to send Syslog messages to an external server.


## Syslog Configuration

# Enable console logging for the Informational severity and higher
logging console 6
# Enable logging for the Informational severity and higher
logging monitor informational
# Logging buffered [size] [level name or number]
logging buffered 8192 6
# Logging to an external server
logging 192.168.1.100
# Or: logging host 192.168.1.100
# Logging trap [level name or number]
logging trap debugging

# Enable Syslog messages when using Telnet or SSH
terminal monitor

# Print a new line when the typing is interrupted by a Syslog message (more user friendly)
line console 0
logging synchronous

# Enable timestamps for Syslog messages
service timestamp log datetime
service sequence-numbers


### Console, Telnet, and SSH (local and remote connections)

## Configure a password on the console
line console 0
password ccna
# Require the user to enter the console password
login

## Configure a username and password on the console
username admin secret ccna
line console 0
# Require a user to login using the configured usernames on the device
login local
# Log the user out after a certain time of inactivity: exec-timeout [minutes] [seconds]
exec-timeout 3 30

## Configure the Switch Virtual Interface (SVI) on a Layer 2 switch for remote connectivity
interface vlan1
ip address 192.168.1.253 255.255.255.0
no shutdown
exit
ip default-gateway 192.168.1.254

## Teletype Network (Telnet) Configuration
# If an enable password or secret is not configured, you won't be able to access priviledged exec mode when connecting via Telnet
enable secret ccna
username admin secret ccna
# Optional. Limit which devices can connect
access-list 1 permit host 192.168.2.1
# There are 16 Virtual Teletype (vty) lines available for up to 16 users
line vty 0 15
login local
# Time out after 5 mins
exec-timeout 5 0
# Allow telnet connections
transport input telnet
# Apply the ACL to the vty lines
access-class 1 in

# Connect via Telnet
telnet [ip-address]

## SSH Configuration
# Hostname and DNS domain name must be defined first
hostname R1
ip domain name cisco.com
# Generate RSA keys
crypto key generate rsa modulus 2048

enable secret ccna
username admin secret ccna
# Optional. Limit which devices can connect
access-list 1 permit host 192.168.2.1
ip ssh version 2
line vty 0 15
login local
# Time out after 5 mins
exec-timeout 5 0
# Allow SSH connections
transport input ssh
# Apply the ACL to the vty lines
access-class 1 in

# Connect via SSH
ssh -l [username] [ip-address]
ssh [username]@[ip-address]


### FTP and TFTP (File Transfer Protocol and Trivial File Transfer Protocol)

TFTP server port listen = UDP 69
FTP control port = TCP 21
FTP data port = TCP 20

# FTPS (FTP over SSL/TLS) is an upgrade to FTP.
# SFTP (SSH File Transfer Protocol) is a different protocol to FTP.

# FTP is more compex than TFTP and allows not only file transfers, but clients can also navigate file directories, add and remove directories, list files, etc.

# In FTP active mode, the server initiates the data connection.
# In FTP passive mode, the client initiates the data connection, which is often necessary when the client is behind a firewall that could block the incoming connection from the server.

## IOS File Systems
show file systems

## Upgrading Cisco IOS
# View the current IOS version
show version
# View the contents of flash
show flash
# Copy the file using TFTP
# copy [source] [destination]
copy tftp: flash:
192.168.1.1
c2900-universalk9-mz.SPA.155-3.M4a.bin

# View the copied file
show flash

# Load and replace the file with the old one
conf t
boot system flash:c2900-universalk9-mz.SPA.155-3.M4a.bin
exit
write memory
reload

# Delete a file in flash
delete flash:c2900-universalk9-mz.SPA.151-4.M4.bin

## FTP copying files to a server
# An FTP username and password must be configured
ip ftp username cisco
ip ftp password cisco
exit
copy ftp: flash:
192.168.1.1
c2900-universalk9-mz.SPA.155-3.M4a.bin

## Password Recovery for the 2900 Integrated Services Router
https://www.cisco.com/c/en/us/support/docs/routers/2800-series-integrated-services-routers/112033-c2900-password-recovery-00.html

# Step-by-Step Procedure
# Perform these steps in order to recover your password:

# 1. Either switch off or shut down the router.
# 2. Remove the compact flash that is on the rear of the router. This image shows the rear of the 2951 router:
# 3. Switch on the router.
# 4. Once the router is on Rommon mode, reinsert the compact flash.
# 5. Type confreg 0x2142 at the rommon 1> prompt in order to boot from Flash.
# This step bypasses the startup configuration where the passwords are stored.
# 6. Type reset at the rommon 2> prompt.
# The router reboots, but ignores the saved configuration.
# 7. Type no after each setup question, or press Ctrl-C in order to skip the initial setup procedure.
# 8. Type enable at the Router> prompt.
# You are in enable mode and should see the Router# prompt.
# 9. Type configure memory or copy startup-config running-config in order to copy the nonvolatile RAM (NVRAM) into memory.
# Warning:  Do not enter copy running-config startup-config or write. These commands erase your startup configuration.
# 10. Issue the show running-config command.
# The show running-config command shows the configuration of the router. In this configuration, the shutdown command appears under all interfaces, which indicates all interfaces are currently shut down. In addition, the passwords (enable password, enable secret, vty, and console passwords) are in either an encrypted or unencrypted format. You can reuse unencrypted passwords. You must change encrypted passwords to a new password.
# 11. Type configure terminal.
# The hostname(config)# prompt appears.
# 12. Type enable secret <password> in order to change the enable secret password. For example:
# hostname(config)#enable secret cisco
# 13. Issue the no shutdown command on every interface that you use.
# If you issue a show ip interface brief command, every interface that you want to use should display up up.
# 14. Type config-register <configuration_register_setting> . Where <configuration_register_setting> is either the value you recorded in step 2 or 0x2102 . For example:
# hostname(config)#config-register 0x2102
# 15. Press Ctrl-z or end in order to leave the configuration mode.
# The hostname# prompt appears.
# 16. Type write memory or copy running-config startup-config in order to commit the changes.


### NAT

# RFC 1918 private IPv4 ranges (cannot be used over the Internet):
# Class A - 10.0.0.0/8 (10.0.0.0 to 10.255.255.255)
# Class B - 172.16.0.0/12 (172.16.0.0 to 172.31.255.255)
# Class C - 192.168.0.0/16 (192.168.0.0 to 192.168.255.255)

## Static NAT

# Involves statically configuring one-to-one mappings of private IP addresses to public IP addresses.
# Inside Local IP address is mapped to an inside global IP address. The IP configured on the host. Usually a private IP address.
# Inside Global IP address is the IP address of the inside host after NAT. Usually a public IP address.
# Outside Local is the IP address of the outside host from the perspective of the local network.
# Outside Global is the IP address of the outside host from the perspective of the outside network.

# Inside / OUtside = Location of the host
# Local / Global = Perspective

# One-to-one mapping allows external hosts to access the internal host via the inside global address.


## Static NAT Configuration

# Define inside interfaces connected to the internal network
int g0/1
ip nat inside
exit
# Define outside interfaces connected to the external network
int g0/0
ip nat outside
exit
# Configure the one-to-one IP address mappings
# ip nat inside source static [inside-local-ip] [inside-global-ip]
ip nat inside source static 192.168.0.167 100.0.0.1
# The following command will be rejected as a static entry already exists
ip nat inside source static 192.168.0.168 100.0.0.1

show ip nat translations
# Clear the dynamic IP translations only (static IP translations will remain)
clear ip nat translation *
show ip nat statistics


## Dynamic NAT

# The router dynamically maps inside local addresses to inside global addresses as needed.

# An ACL is used to identify which traffic should be translated.
# If the source IP is permitted by the ACL, then it will be translated.
# If the source IP is denied by the ACL, then it will NOT be translated (traffic will not be dropped).

# A NAT pool is used to determine the available inside global addresses.

# The mappings are still one-to-one (one inside local IP address per inside global IP address).

# If there aren't enough inside global IP addresses available (all are currently being used), it is called 'NAT pool exhaustion'.
# If a packet from another inside host arrives and needs NAT but there are no available addresses, the router will drop the packet.
# The host will be unable to access outside networks until one of the inside global IP addresses becomes available.
# Dynamic NAT entries will time out automatically if not used, or you can clear them manually.


## Dynamic NAT Configuration

# Define inside interfaces connected to the internal network
int g0/1
ip nat inside
exit
# Define outside interfaces connected to the external network
int g0/0
ip nat outside
exit

# Define the traffic that should be translated, permitted by the ACL
acccess-list 1 permit 192.168.0.0 0.0.0.255

# Define the pool of inside global IP addresses (instead of prefix-length 24, you can use netmask 255.255.255.0)
ip nat pool POOL1 100.0.0.0 100.0.0.255 prefix-length 24

# Configure dynamic NAT by mapping the ACL to the pool
ip nat inside source list 1 pool POOL1

# Clear NAT table. Only dynamic NAT translations will be cleared (static NAT entries will remain)
show ip nat translations

show ip nat statistics
# UDP and ICMP mappings are cleared about 1 minute later (statistics show as extended entries)
# The original dynamic mappings will be cleared after 24 hours (statistics show as dynamic entries)


## Dynamic PAT

# Port Address Translation (aka NAT overload) translates both the IP address and the port number (if necessary).
# By using a unique port number for each communication flow, a single public IP address can be used by many different internal hosts.
# Port numbers are 16 bits = over 65000 available port numbers.

# Inside local addresses (private IP on hosts) are translated to inside global (the public IP on the external interface)

# The router will keep track of which inside local address is using which inside global address and port.

# Because many inside hosts can share a single public IP, PAT is very useful for preserving public IP addresses, and it is used in networks all over the world.


## Configure PAT (pool)

# Define inside interfaces connected to the internal network
int g0/1
ip nat inside
exit
# Define outside interfaces connected to the external network
int g0/0
ip nat outside
exit

# Define the traffic that should be translated, permitted by the ACL
acccess-list 1 permit 192.168.0.0 0.0.0.255

# Define the pool of inside global IP addresses (instead of prefix-length 24, you can use netmask 255.255.255.0)
ip nat pool POOL1 100.0.0.0 100.0.0.255 prefix-length 24

# Configure PAT by mapping the ACL to the pool and using the overload keyword at the end
ip nat inside source list 1 pool POOL1 overload

show ip nat translations


## Configure PAT (interface)

# Define inside interfaces connected to the internal network
int g0/1
ip nat inside
exit
# Define outside interfaces connected to the external network
int g0/0
ip nat outside
exit

# Define the traffic that should be translated, permitted by the ACL
acccess-list 1 permit 192.168.0.0 0.0.0.255

# Configure PAT by mapping the ACL to the interface and enabling overload
ip nat inside source list 1 interface g0/0 overload

show ip nat translations


### Quality of Service (QoS) and Power over Ethernet (PoE)

## IP Phones
# Traditional phones operate over the Public Switched Telephone Network (PSTN).
# Sometimes this is called Plain Old Telephone Service (POTS).
# IP phones use Voice over IP (VoIP) technologies to enable phone calls over an IP network, such as the Internet.
# IP phones are connected to a switch just like any other end host.

# IP phones have an internal 3-port switch.
# 1 port is the uplink to the external switch
# 1 port is the downlink to the Procedure
# 1 port conencts internally to the phone itself

# This allows the PC and the IP phone to share a single switch port. Traffic from the PC passes through the IP phone to the switch.
# It is recommended to separate voice traffic (from the IP phone) and data traffic (from the PC) by placing them in separate VLANs.
# This can be accomplished using a voice VLAN
# Traffic from the PC will be untagged, but traffic from the phone will be tagged with a VLAN ID.

## Configure a switchport for IP phone and PC setup
interface g0/0
switchport mode access
switchport access vlan 10
switchport voice vlan 11

show interfaces g0/0 switchport

## Power over Ethernet (PoE)
# PoE allows Power Sourcing Equipment (PSE) to provide Powered Devices (PD) over an Ethernet cable.
# Typically the PSE is a switch and the PDs are IP phones, IP cameras, Wireless Access Points (WAPS), etc.
# The PSE receives AC power from the outlet, converts it to DC power, and supplies that DC power to the PDs.
# The same cables are also used to transmit data.
# Too much electrical current can damage electrical devices.
# PoE has a process to determine if a connected device needs power, and how much power it needs.
# When a device is connected to a PoE-enabled port, the PSE (switch) sends low power signals, monitors the response, and determines how much power the PD needs.
# If the device needs power, the PSE supplies the power to allow the PD to boot.
# The PSE continues to monitor the PD and supply the required amount of power (but not too much).

# Power policing can be configured to prevent a PD from taking too much power.
# Configure power policing with the default settings: disabled the port and send a Syslog message if a PD draws too much power.
power inline police 
# Equivalent to:
power inline police action err-disable
# The interface will be put in an error-disabled state and can be re-enabled with the shutdown command followed by the no shutdown command.
# The following command does not shut down the interface if the PD draws too much power. It will restart the interface and send a Syslog message.
power inline police action log

show power inline police g0/0

## PoE Standards

# Name | Standard | Watts | Powered Wire Pairs
# Cisco Inline Power (ILP) | Made by Cisco, not standard | 7 | 2
# PoE (Type 1) | 802.3af | 15 | 2
# PoE+ (Type 2) | 802.3.at | 30 | 2
# UPoE (Type 3) | 802.3.bt | 60 | 4
# UPoE+ (Type 4) | 802.3.bt | 100 | 4


## Quality of Service (QoS)
# Voice traffic and data traffic used to use entirely separate networks.
# Voice traffic used the PSTN
# Data traffic used the IP network (enterprise WAN, Internet, etc)

# QoS wasn't necessary as the different kinds of traffic didn't compete for bandwidth.

# Modern networks are typically converged networks in which IP phones, video traffic, regular data traffic, etc all share the same IP network.
# This enable  cost savings as well as more advanced features for voice and video traffic, for examples integrations with collaboration software (Cisco WebEx, Microsoft Teams, etc).
# However, the kinds of traffic now have to compete for bandwidth.
# QoS is a set of tools used by network devices to apply different treatment to different packets.

# QoS is used to manage the following characteristics of network traffic:
1) Bandwidth
# The overall capacity of the link, measured in bits per second (Kbps, Mbps, Gbps, etc)
# QoS tools allow you to reserve a certain amount of a link's bandwidth for specific kinds of traffic.
# For example: 20% voice traffic, 30% for specific kinds of data traffic, leaving 50% for all other traffic.
2) Delay
# The amount of time it takes traffic to go from source to destination = one-way delay
# The amount of time it takes traffic to go from source to destination and return = two-way delay
3) Jitter
# The variation in one-way delay between packets sent by the same application
# IP phones have a jitter buffer to provide a fixed delay to audio packets
4) Loss
# The percentage of packets sent that do not reach their destination
# Can be caused by faulty cables
# Can also be caused whe na device's packet queues get full and the device starts discarding packets.

# The following standards are recommended for acceptable interactive audio (ie. phone call) quality:
# One-way delay: 150 ms or less
# Jitter: 30 ms or less
# Loss: 1% or less

# If the standards are not met, there could be a noticable reduction in the quality of the phone call.

## QoS Queuing
# If a network device receives messages faster than it can forward them out of the appropriate interface, the messages are placed in a queue.
# By default, queued messages will be forwarded in a First In First Out (FIFO) manner.
# Messages will be sent in the order they are received.
# If the queue is full, new packets will be dropped. This is called tail drop.
# Tail drop is harmful because it can lead to TCP global synchronizaion.

# Review of the TCP sliding window:
# Hosts using TCP use the sliding window to increase / decrease the rate at which they send traffic as needed.
# When a packet is dropped, it will be re-transmitted.
# When a drop occurs, the sender will reduce the rate it sends traffic.
# It will then gradually increase the rate again.

# When the queue fills up and tail drop occurs, all TCP hosts sending traffic will slow down the rate at which they send traffic.
# They will all then increase the rate at which they send traffic, which rapidly leads to more congestion, dropped packets, and the process repeats again.

# Network congestion -> Tail drop -> Global TCP window size decrease -> Network underutilized -> Global TCP window size increase

# A solution to prevent tail drop and TCP global synchronizaion is Random Early Detection (RED).
# When the amount of traffic in the queue reaches a certain threshold, the device will start randomly dropping packets from select TCP flows.
# Those TCP flows that dropped packets will reduce the rate at which traffic is sent, but you will avoid global TCP synchronizaion, in which ALL TCP flows reduce and then increase the rate of transmission at the same time in waves.
# In standard RED, all kinds of traffic are treated the same.
# An improved version, Weighted Random Early Detection (WRED), allows you to control which packets are dropped depending on the traffic class.

